<!doctype html>
<html lang="ar" dir="rtl">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ูุณุงุนุฏ ุญุณุงุจุงุช</title>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
      body {
        box-sizing: border-box;
      }
      .glass-card {
        background: rgba(16, 185, 129, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(16, 185, 129, 0.1);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      }
      .glass-input {
        background: rgba(16, 185, 129, 0.08);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(16, 185, 129, 0.15);
        color: white;
        transition: all 0.3s ease;
      }
      .glass-input:focus {
        background: rgba(16, 185, 129, 0.12);
        border-color: rgba(16, 185, 129, 0.5);
        outline: none;
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
      }
      .glass-input::placeholder {
        color: rgba(255, 255, 255, 0.4);
      }
      .glass-button-primary {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.3));
        backdrop-filter: blur(10px);
        border: 1px solid rgba(16, 185, 129, 0.2);
        color: white;
        transition: all 0.3s ease;
      }
      .glass-button-primary:hover {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.5), rgba(5, 150, 105, 0.5));
        box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        transform: translateY(-2px);
      }
      .glass-button-secondary {
        background: rgba(239, 68, 68, 0.2);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(239, 68, 68, 0.3);
        color: white;
        transition: all 0.3s ease;
      }
      .glass-button-secondary:hover {
        background: rgba(239, 68, 68, 0.4);
        box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
      }
      .glass-nav-button {
        background: rgba(16, 185, 129, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(16, 185, 129, 0.1);
        color: rgba(255, 255, 255, 0.7);
        transition: all 0.3s ease;
      }
      .glass-nav-button:hover {
        background: rgba(16, 185, 129, 0.1);
        color: white;
        transform: translateY(-2px);
      }
      .glass-nav-button.active {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.3));
        border-color: rgba(16, 185, 129, 0.5);
        color: white;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
      }
      .glass-stat-card {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
        backdrop-filter: blur(10px);
        border: 1px solid rgba(16, 185, 129, 0.15);
        transition: all 0.3s ease;
      }
      .glass-stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 35px rgba(16, 185, 129, 0.3);
      }
      .glass-table-header {
        background: rgba(16, 185, 129, 0.15);
        backdrop-filter: blur(10px);
      }
      .glass-table-row {
        background: rgba(16, 185, 129, 0.03);
        border-bottom: 1px solid rgba(16, 185, 129, 0.05);
        transition: all 0.2s ease;
      }
      .glass-table-row:hover {
        background: rgba(16, 185, 129, 0.08);
      }
      select.glass-input option {
        background: #064e3b;
        color: white;
      }
      .modal-overlay {
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(5px);
      }
      .phone-link {
        color: #10b981;
        text-decoration: underline;
        cursor: pointer;
      }
      .phone-link:hover {
        color: #34d399;
      }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="min-h-full" style="background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);"><!-- Confirmation Modal -->
  <div id="confirmation-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center modal-overlay">
   <div class="glass-card rounded-2xl p-6 max-w-md w-full mx-4">
    <h3 class="text-xl font-bold text-white mb-4" id="modal-title">ุชุฃููุฏ ุงูุนูููุฉ</h3>
    <p class="text-slate-300 mb-6" id="modal-message">ูู ุฃูุช ูุชุฃูุฏ ูู ูุฐู ุงูุนูููุฉุ</p>
    <div class="flex gap-3"><button onclick="confirmAction()" class="glass-button-primary flex-1 py-2 rounded-xl font-bold">โ ุชุฃููุฏ</button> <button onclick="closeModal()" class="glass-button-secondary flex-1 py-2 rounded-xl font-bold">โ ุฅูุบุงุก</button>
    </div>
   </div>
  </div>
  <div class="min-h-full p-6">
   <header class="glass-card rounded-2xl p-6 mb-6">
    <h1 class="text-4xl font-bold text-white mb-2">๐พ ูุณุงุนุฏ ุญุณุงุจุงุช</h1>
    <p class="text-slate-300">ูุธุงู ูุชูุงูู ูุฅุฏุงุฑุฉ ุงููุจูุนุงุช ูุงููุดุชุฑูุงุช ูุงููุฎุฒูู</p>
   </header>
   <nav class="glass-card rounded-2xl p-4 mb-6">
    <div class="flex flex-wrap gap-2"><button onclick="showTab('dashboard')" class="glass-nav-button px-4 py-2 rounded-xl transition active" id="tab-dashboard">๐ ููุญุฉ ุงูุชุญูู</button> <button onclick="showTab('sales')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-sales">๐ฐ ุงููุจูุนุงุช</button> <button onclick="showTab('purchases')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-purchases">๐ ุงููุดุชุฑูุงุช</button> <button onclick="showTab('expenses')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-expenses">๐ธ ุงููุตุฑููุงุช</button> <button onclick="showTab('receivables')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-receivables">๐ผ ุงูุฐูู</button> <button onclick="showTab('customers')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-customers">๐ฅ ุงูุนููุงุก</button> <button onclick="showTab('suppliers')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-suppliers">๐ญ ุงูููุฑุฏูู</button> <button onclick="showTab('products')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-products">๐ฆ ุงูููุชุฌุงุช</button> <button onclick="showTab('inventory')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-inventory">๐ ุงููุฎุฒูู</button> <button onclick="showTab('accounts')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-accounts">๐ผ ุงูุญุณุงุจุงุช</button> <button onclick="showTab('reports')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-reports">๐ ุงูุชูุงุฑูุฑ</button> <button onclick="showTab('crm')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-crm">๐ค CRM</button> <button onclick="showTab('settings')" class="glass-nav-button px-4 py-2 rounded-xl transition" id="tab-settings">โ๏ธ ุงูุฅุนุฏุงุฏุงุช</button>
    </div>
   </nav><!-- Dashboard -->
   <div id="content-dashboard" class="tab-content">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-3xl mb-2">
       ๐ฐ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุฅุฌูุงูู ุงููุจูุนุงุช
      </div>
      <div class="text-3xl font-bold text-white" id="dash-total-sales">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-3xl mb-2">
       ๐
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ูุฌูู ุงูุฑุจุญ
      </div>
      <div class="text-3xl font-bold text-white" id="dash-gross-profit">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-3xl mb-2">
       ๐ธ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุฅุฌูุงูู ุงููุตุฑููุงุช
      </div>
      <div class="text-3xl font-bold text-white" id="dash-total-expenses">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-3xl mb-2">
       ๐
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุตุงูู ุงูุฑุจุญ
      </div>
      <div class="text-3xl font-bold text-white" id="dash-net-profit">
       0 ุฌ.ู
      </div>
     </div>
    </div><!-- Financial Ratios -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
     <div class="glass-card rounded-2xl p-6">
      <h3 class="text-lg font-bold text-white mb-3">๐ ูุงูุด ูุฌูู ุงูุฑุจุญ</h3>
      <div class="text-3xl font-bold text-green-400" id="dash-gross-margin">
       0%
      </div>
     </div>
     <div class="glass-card rounded-2xl p-6">
      <h3 class="text-lg font-bold text-white mb-3">๐ ูุงูุด ุตุงูู ุงูุฑุจุญ</h3>
      <div class="text-3xl font-bold text-green-400" id="dash-net-margin">
       0%
      </div>
     </div>
     <div class="glass-card rounded-2xl p-6">
      <h3 class="text-lg font-bold text-white mb-3">โ๏ธ ููุทุฉ ุงูุชุนุงุฏู</h3>
      <div class="text-3xl font-bold text-yellow-400" id="dash-break-even">
       0 ุฌ.ู
      </div>
     </div>
    </div><!-- Accounts Summary -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-2xl mb-2">
       ๐ต
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุงูุตูุฏูู
      </div>
      <div class="text-2xl font-bold text-white" id="dash-cash-balance">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-2xl mb-2">
       ๐ฆ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุงูุจูู
      </div>
      <div class="text-2xl font-bold text-white" id="dash-bank-balance">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-2xl mb-2">
       ๐ฑ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ููุฏุงููู ูุงุด
      </div>
      <div class="text-2xl font-bold text-white" id="dash-vodafone-balance">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-2xl mb-2">
       ๐ณ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุงูุณุชุง ุจุงู
      </div>
      <div class="text-2xl font-bold text-white" id="dash-instapay-balance">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-red-400 text-2xl mb-2">
       ๐ฅ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุฐูู ุงูุนููุงุก
      </div>
      <div class="text-2xl font-bold text-white" id="dash-customers-debt">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-red-400 text-2xl mb-2">
       ๐ญ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุฐูู ุงูููุฑุฏูู
      </div>
      <div class="text-2xl font-bold text-white" id="dash-suppliers-debt">
       0 ุฌ.ู
      </div>
     </div>
    </div>
   </div><!-- Sales -->
   <div id="content-sales" class="tab-content hidden">
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">โ ุฅุถุงูุฉ ูุงุชูุฑุฉ ูุจูุนุงุช</h2>
     <form id="sales-form" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุงูุนููู</label> <input type="text" id="sale-customer-search" class="glass-input w-full px-4 py-3 rounded-xl mb-2" placeholder="ุงุจุญุซ ุนู ุนููู..."> <select id="sale-customer" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="">ุงุฎุชุฑ ุนููู</option> </select>
       </div>
       <div><label class="block text-slate-300 mb-2">ุทุฑููุฉ ุงูุฏูุน</label> <select id="sale-payment-method" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="ููุฏู">ููุฏู</option> <option value="ุขุฌู">ุขุฌู</option> <option value="ููุฏุงููู ูุงุด">ููุฏุงููู ูุงุด</option> <option value="ุงูุณุชุง ุจุงู">ุงูุณุชุง ุจุงู</option> </select>
       </div>
      </div>
      <div id="sale-items">
       <div class="sale-item glass-card p-4 rounded-xl mb-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
         <div><label class="block text-slate-300 mb-2">ุงูููุชุฌ</label> <select class="sale-product glass-input w-full px-4 py-3 rounded-xl" required> <option value="">ุงุฎุชุฑ ููุชุฌ</option> </select>
         </div>
         <div><label class="block text-slate-300 mb-2">ุงููููุฉ</label> <input type="number" class="sale-quantity glass-input w-full px-4 py-3 rounded-xl" min="1" step="0.01" required>
         </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
         <div><label class="block text-slate-300 mb-2">ุงูุณุนุฑ</label> <input type="number" class="sale-price glass-input w-full px-4 py-3 rounded-xl" step="0.01" required>
         </div>
         <div><label class="block text-slate-300 mb-2">ุงูุฎุตู %</label> <input type="number" class="sale-discount glass-input w-full px-4 py-3 rounded-xl" min="0" max="100" step="0.01" value="0">
         </div>
         <div><label class="block text-slate-300 mb-2">ุงูุฅุฌูุงูู</label> <input type="text" class="sale-item-total glass-input w-full px-4 py-3 rounded-xl" readonly>
         </div>
        </div>
       </div>
      </div>
      <div class="flex gap-3"><button type="button" onclick="addSaleItem()" class="glass-button-primary px-4 py-2 rounded-xl">โ ุฅุถุงูุฉ ุจูุฏ ุฌุฏูุฏ</button>
      </div>
      <div class="glass-card p-4 rounded-xl">
       <div class="flex justify-between items-center"><span class="text-white font-bold text-xl">ุงูุฅุฌูุงูู ุงูููู:</span> <span class="text-green-400 font-bold text-2xl" id="sale-grand-total">0 ุฌ.ู</span>
       </div>
      </div><button type="submit" class="glass-button-primary w-full py-3 rounded-xl font-bold">๐พ ุญูุธ ุงููุงุชูุฑุฉ</button>
     </form>
    </div>
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ุณุฌู ุงููุจูุนุงุช</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="glass-table-header">
        <tr>
         <th class="px-4 py-3 text-right text-white">ุฑูู ุงููุงุชูุฑุฉ</th>
         <th class="px-4 py-3 text-right text-white">ุงูุชุงุฑูุฎ</th>
         <th class="px-4 py-3 text-right text-white">ุงูุนููู</th>
         <th class="px-4 py-3 text-right text-white">ุงูุฅุฌูุงูู</th>
         <th class="px-4 py-3 text-right text-white">ุงูุฏูุน</th>
         <th class="px-4 py-3 text-right text-white">ุฅุฌุฑุงุกุงุช</th>
        </tr>
       </thead>
       <tbody id="sales-list">
        <tr class="glass-table-row">
         <td colspan="6" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ูุจูุนุงุช ุจุนุฏ</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div><!-- Purchases -->
   <div id="content-purchases" class="tab-content hidden">
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">โ ุฅุถุงูุฉ ูุงุชูุฑุฉ ูุดุชุฑูุงุช</h2>
     <form id="purchase-form" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุงูููุฑุฏ</label> <select id="purchase-supplier" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="">ุงุฎุชุฑ ููุฑุฏ</option> </select>
       </div>
       <div><label class="block text-slate-300 mb-2">ุทุฑููุฉ ุงูุฏูุน</label> <select id="purchase-payment-method" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="ููุฏู">ููุฏู</option> <option value="ุขุฌู">ุขุฌู</option> <option value="ููุฏุงููู ูุงุด">ููุฏุงููู ูุงุด</option> <option value="ุงูุณุชุง ุจุงู">ุงูุณุชุง ุจุงู</option> </select>
       </div>
      </div>
      <div id="purchase-items">
       <div class="purchase-item glass-card p-4 rounded-xl mb-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
         <div><label class="block text-slate-300 mb-2">ุงุณู ุงูููุชุฌ/ุงูุฎุงู</label> <input type="text" class="purchase-product-name glass-input w-full px-4 py-3 rounded-xl" placeholder="ุฃุฏุฎู ุงุณู ุงูููุชุฌ" required>
         </div>
         <div><label class="block text-slate-300 mb-2">ุงููููุฉ</label> <input type="number" class="purchase-quantity glass-input w-full px-4 py-3 rounded-xl" min="1" step="0.01" required>
         </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div><label class="block text-slate-300 mb-2">ุงูุณุนุฑ</label> <input type="number" class="purchase-price glass-input w-full px-4 py-3 rounded-xl" step="0.01" required>
         </div>
         <div><label class="block text-slate-300 mb-2">ุงูุฅุฌูุงูู</label> <input type="text" class="purchase-item-total glass-input w-full px-4 py-3 rounded-xl" readonly>
         </div>
        </div>
       </div>
      </div>
      <div class="flex gap-3"><button type="button" onclick="addPurchaseItem()" class="glass-button-primary px-4 py-2 rounded-xl">โ ุฅุถุงูุฉ ุจูุฏ ุฌุฏูุฏ</button>
      </div>
      <div class="glass-card p-4 rounded-xl">
       <div class="flex justify-between items-center"><span class="text-white font-bold text-xl">ุงูุฅุฌูุงูู ุงูููู:</span> <span class="text-green-400 font-bold text-2xl" id="purchase-grand-total">0 ุฌ.ู</span>
       </div>
      </div><button type="submit" class="glass-button-primary w-full py-3 rounded-xl font-bold">๐พ ุญูุธ ุงููุงุชูุฑุฉ</button>
     </form>
    </div>
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ุณุฌู ุงููุดุชุฑูุงุช</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="glass-table-header">
        <tr>
         <th class="px-4 py-3 text-right text-white">ุฑูู ุงููุงุชูุฑุฉ</th>
         <th class="px-4 py-3 text-right text-white">ุงูุชุงุฑูุฎ</th>
         <th class="px-4 py-3 text-right text-white">ุงูููุฑุฏ</th>
         <th class="px-4 py-3 text-right text-white">ุงูุฅุฌูุงูู</th>
         <th class="px-4 py-3 text-right text-white">ุงูุฏูุน</th>
         <th class="px-4 py-3 text-right text-white">ุฅุฌุฑุงุกุงุช</th>
        </tr>
       </thead>
       <tbody id="purchases-list">
        <tr class="glass-table-row">
         <td colspan="6" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ูุดุชุฑูุงุช ุจุนุฏ</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div><!-- Expenses -->
   <div id="content-expenses" class="tab-content hidden">
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">โ ุฅุถุงูุฉ ูุตุฑูู</h2>
     <form id="expense-form" class="space-y-4">
      <div><label class="block text-slate-300 mb-2">ููุน ุงููุตุฑูู</label> <select id="expense-category" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="">ุงุฎุชุฑ ููุน ุงููุตุฑูู</option> </select>
      </div>
      <div><label class="block text-slate-300 mb-2">ุงููุตู</label> <input type="text" id="expense-description" class="glass-input w-full px-4 py-3 rounded-xl" required>
      </div>
      <div><label class="block text-slate-300 mb-2">ุงููุจูุบ</label> <input type="number" id="expense-amount" class="glass-input w-full px-4 py-3 rounded-xl" step="0.01" min="0" required>
      </div>
      <div><label class="block text-slate-300 mb-2">ุทุฑููุฉ ุงูุฏูุน</label> <select id="expense-payment-method" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="ููุฏู">ููุฏู</option> <option value="ุจูู">ุจูู</option> <option value="ููุฏุงููู ูุงุด">ููุฏุงููู ูุงุด</option> <option value="ุงูุณุชุง ุจุงู">ุงูุณุชุง ุจุงู</option> </select>
      </div><button type="submit" class="glass-button-primary w-full py-3 rounded-xl font-bold">๐พ ุญูุธ ุงููุตุฑูู</button>
     </form>
    </div>
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ุณุฌู ุงููุตุฑููุงุช</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="glass-table-header">
        <tr>
         <th class="px-4 py-3 text-right text-white">ุงูุชุงุฑูุฎ</th>
         <th class="px-4 py-3 text-right text-white">ุงูููุน</th>
         <th class="px-4 py-3 text-right text-white">ุงููุตู</th>
         <th class="px-4 py-3 text-right text-white">ุงููุจูุบ</th>
         <th class="px-4 py-3 text-right text-white">ุงูุฏูุน</th>
         <th class="px-4 py-3 text-right text-white">ุฅุฌุฑุงุกุงุช</th>
        </tr>
       </thead>
       <tbody id="expenses-list">
        <tr class="glass-table-row">
         <td colspan="6" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ูุตุฑููุงุช ุจุนุฏ</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div><!-- Receivables (ุงูุฐูู) -->
   <div id="content-receivables" class="tab-content hidden">
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><!-- Customer Receivables -->
     <div class="glass-card rounded-2xl p-6">
      <h2 class="text-2xl font-bold text-white mb-4">๐ฅ ุฐูู ุงูุนููุงุก</h2>
      <div class="overflow-x-auto">
       <table class="w-full">
        <thead class="glass-table-header">
         <tr>
          <th class="px-4 py-3 text-right text-white">ุงูุนููู</th>
          <th class="px-4 py-3 text-right text-white">ุงููุฏููููุฉ</th>
          <th class="px-4 py-3 text-right text-white">ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="customer-receivables-list">
         <tr class="glass-table-row">
          <td colspan="3" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ุฐูู</td>
         </tr>
        </tbody>
       </table>
      </div>
     </div><!-- Supplier Payables -->
     <div class="glass-card rounded-2xl p-6">
      <h2 class="text-2xl font-bold text-white mb-4">๐ญ ุฐูู ุงูููุฑุฏูู</h2>
      <div class="overflow-x-auto">
       <table class="w-full">
        <thead class="glass-table-header">
         <tr>
          <th class="px-4 py-3 text-right text-white">ุงูููุฑุฏ</th>
          <th class="px-4 py-3 text-right text-white">ุงููุฏููููุฉ</th>
          <th class="px-4 py-3 text-right text-white">ุฅุฌุฑุงุกุงุช</th>
         </tr>
        </thead>
        <tbody id="supplier-payables-list">
         <tr class="glass-table-row">
          <td colspan="3" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ุฐูู</td>
         </tr>
        </tbody>
       </table>
      </div>
     </div>
    </div><!-- Payment Form -->
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ฐ ุชุณุฌูู ุณุฏุงุฏ</h2>
     <form id="payment-form" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ููุน ุงูุณุฏุงุฏ</label> <select id="payment-type" class="glass-input w-full px-4 py-3 rounded-xl" required onchange="updatePaymentOptions()"> <option value="">ุงุฎุชุฑ ููุน ุงูุณุฏุงุฏ</option> <option value="customer">ุณุฏุงุฏ ูู ุนููู</option> <option value="supplier">ุณุฏุงุฏ ูููุฑุฏ</option> </select>
       </div>
       <div><label class="block text-slate-300 mb-2" id="payment-entity-label">ุงูุฌูุฉ</label> <select id="payment-entity" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="">ุงุฎุชุฑ ุงูุฌูุฉ</option> </select>
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุงููุจูุบ</label> <input type="number" id="payment-amount" class="glass-input w-full px-4 py-3 rounded-xl" step="0.01" min="0" required>
       </div>
       <div><label class="block text-slate-300 mb-2">ุทุฑููุฉ ุงูุฏูุน</label> <select id="payment-method" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="ููุฏู">ููุฏู</option> <option value="ุจูู">ุจูู</option> <option value="ููุฏุงููู ูุงุด">ููุฏุงููู ูุงุด</option> <option value="ุงูุณุชุง ุจุงู">ุงูุณุชุง ุจุงู</option> </select>
       </div>
      </div>
      <div><label class="block text-slate-300 mb-2">ููุงุญุธุงุช</label> <textarea id="payment-notes" class="glass-input w-full px-4 py-3 rounded-xl" rows="2"></textarea>
      </div><button type="submit" class="glass-button-primary w-full py-3 rounded-xl font-bold">๐พ ุชุณุฌูู ุงูุณุฏุงุฏ</button>
     </form>
    </div><!-- Payment History -->
    <div class="glass-card rounded-2xl p-6 mt-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ุณุฌู ุงูุณุฏุงุฏุงุช</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="glass-table-header">
        <tr>
         <th class="px-4 py-3 text-right text-white">ุงูุชุงุฑูุฎ</th>
         <th class="px-4 py-3 text-right text-white">ุงูููุน</th>
         <th class="px-4 py-3 text-right text-white">ุงูุฌูุฉ</th>
         <th class="px-4 py-3 text-right text-white">ุงููุจูุบ</th>
         <th class="px-4 py-3 text-right text-white">ุทุฑููุฉ ุงูุฏูุน</th>
         <th class="px-4 py-3 text-right text-white">ุฅุฌุฑุงุกุงุช</th>
        </tr>
       </thead>
       <tbody id="payments-list">
        <tr class="glass-table-row">
         <td colspan="6" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ุณุฏุงุฏุงุช ุจุนุฏ</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div><!-- Customers -->
   <div id="content-customers" class="tab-content hidden">
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">โ ุฅุถุงูุฉ ุนููู</h2>
     <form id="customer-form" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุงุณู ุงูุนููู</label> <input type="text" id="customer-name" class="glass-input w-full px-4 py-3 rounded-xl" required>
       </div>
       <div><label class="block text-slate-300 mb-2">ููุน ุงูุนููู</label> <select id="customer-type" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="">ุงุฎุชุฑ ููุน ุงูุนููู</option> </select>
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
       <div><label class="block text-slate-300 mb-2">ุฑูู ุงููุงุชู</label> <input type="tel" id="customer-phone" class="glass-input w-full px-4 py-3 rounded-xl" required>
       </div>
       <div><label class="block text-slate-300 mb-2">ูุงุชู ุฅุถุงูู 1</label> <input type="tel" id="customer-phone2" class="glass-input w-full px-4 py-3 rounded-xl">
       </div>
       <div><label class="block text-slate-300 mb-2">ูุงุชู ุฅุถุงูู 2</label> <input type="tel" id="customer-phone3" class="glass-input w-full px-4 py-3 rounded-xl">
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุงููุญุตูู 1</label> <select id="customer-crop1" class="glass-input w-full px-4 py-3 rounded-xl"> <option value="">ุงุฎุชุฑ ูุญุตูู</option> </select>
       </div>
       <div><label class="block text-slate-300 mb-2">ุงููุญุตูู 2</label> <select id="customer-crop2" class="glass-input w-full px-4 py-3 rounded-xl"> <option value="">ุงุฎุชุฑ ูุญุตูู</option> </select>
       </div>
      </div>
      <div><label class="block text-slate-300 mb-2">ุงูุนููุงู</label> <input type="text" id="customer-address" class="glass-input w-full px-4 py-3 rounded-xl">
      </div><button type="submit" class="glass-button-primary w-full py-3 rounded-xl font-bold">๐พ ุญูุธ ุงูุนููู</button>
     </form>
    </div>
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ูุงุฆูุฉ ุงูุนููุงุก</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="glass-table-header">
        <tr>
         <th class="px-4 py-3 text-right text-white">ุงูุงุณู</th>
         <th class="px-4 py-3 text-right text-white">ุงูููุน</th>
         <th class="px-4 py-3 text-right text-white">ุงููุงุชู</th>
         <th class="px-4 py-3 text-right text-white">ุงููุญุงุตูู</th>
         <th class="px-4 py-3 text-right text-white">ุงูุนููุงู</th>
         <th class="px-4 py-3 text-right text-white">ุฅุฌุฑุงุกุงุช</th>
        </tr>
       </thead>
       <tbody id="customers-list">
        <tr class="glass-table-row">
         <td colspan="6" class="px-4 py-8 text-center text-slate-400">ูุง ููุฌุฏ ุนููุงุก ุจุนุฏ</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div><!-- Suppliers -->
   <div id="content-suppliers" class="tab-content hidden">
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">โ ุฅุถุงูุฉ ููุฑุฏ</h2>
     <form id="supplier-form" class="space-y-4">
      <div><label class="block text-slate-300 mb-2">ุงูุงุณู</label> <input type="text" id="supplier-name" class="glass-input w-full px-4 py-3 rounded-xl" required>
      </div>
      <div><label class="block text-slate-300 mb-2">ุงููุงุชู</label> <input type="tel" id="supplier-phone" class="glass-input w-full px-4 py-3 rounded-xl" required>
      </div>
      <div><label class="block text-slate-300 mb-2">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label> <input type="email" id="supplier-email" class="glass-input w-full px-4 py-3 rounded-xl">
      </div>
      <div><label class="block text-slate-300 mb-2">ุงูุนููุงู</label> <input type="text" id="supplier-address" class="glass-input w-full px-4 py-3 rounded-xl">
      </div><button type="submit" class="glass-button-primary w-full py-3 rounded-xl font-bold">๐พ ุญูุธ ุงูููุฑุฏ</button>
     </form>
    </div>
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ูุงุฆูุฉ ุงูููุฑุฏูู</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="glass-table-header">
        <tr>
         <th class="px-4 py-3 text-right text-white">ุงูุงุณู</th>
         <th class="px-4 py-3 text-right text-white">ุงููุงุชู</th>
         <th class="px-4 py-3 text-right text-white">ุงูุจุฑูุฏ</th>
         <th class="px-4 py-3 text-right text-white">ุงูุนููุงู</th>
         <th class="px-4 py-3 text-right text-white">ุฅุฌุฑุงุกุงุช</th>
        </tr>
       </thead>
       <tbody id="suppliers-list">
        <tr class="glass-table-row">
         <td colspan="5" class="px-4 py-8 text-center text-slate-400">ูุง ููุฌุฏ ููุฑุฏูู ุจุนุฏ</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div><!-- Products -->
   <div id="content-products" class="tab-content hidden">
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">โ ุฅุถุงูุฉ ููุชุฌ</h2>
     <form id="product-form" class="space-y-4">
      <div><label class="block text-slate-300 mb-2">ุงุณู ุงูููุชุฌ</label> <input type="text" id="product-name" class="glass-input w-full px-4 py-3 rounded-xl" required>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุชูููุฉ ุงููุญุฏุฉ</label> <input type="number" id="product-cost" class="glass-input w-full px-4 py-3 rounded-xl" step="0.01" min="0" required>
       </div>
       <div><label class="block text-slate-300 mb-2">ุณุนุฑ ุงูุจูุน ูุณุชููู</label> <input type="number" id="product-price" class="glass-input w-full px-4 py-3 rounded-xl" step="0.01" min="0" required>
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุณุนุฑ ุงูุจูุน ุฌููุฉ</label> <input type="number" id="product-wholesale" class="glass-input w-full px-4 py-3 rounded-xl" step="0.01" min="0" required>
       </div>
       <div><label class="block text-slate-300 mb-2">ุฌููุฉ ุงููุฑุชููุฉ</label> <input type="number" id="product-carton-wholesale" class="glass-input w-full px-4 py-3 rounded-xl" step="0.01" min="0" required>
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุนุฏุฏ ุงูุนุจูุงุช ูู ุงููุฑุชููุฉ</label> <input type="number" id="product-units-per-carton" class="glass-input w-full px-4 py-3 rounded-xl" min="1" required>
       </div>
       <div><label class="block text-slate-300 mb-2">ุงููุญุฏุฉ</label> <select id="product-unit" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="">ุงุฎุชุฑ ุงููุญุฏุฉ</option> </select>
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุงููููุฉ ุงููุชููุฑุฉ ูู ุงููุฎุฒูู</label> <input type="number" id="product-current-stock" class="glass-input w-full px-4 py-3 rounded-xl" min="0" step="0.01" value="0" required>
       </div>
       <div><label class="block text-slate-300 mb-2">ุงูุญุฏ ุงูุฃุฏูู ูููุฎุฒูู</label> <input type="number" id="product-min-stock" class="glass-input w-full px-4 py-3 rounded-xl" min="0" step="0.01" required>
       </div>
      </div><button type="submit" class="glass-button-primary w-full py-3 rounded-xl font-bold">๐พ ุญูุธ ุงูููุชุฌ</button>
     </form>
    </div>
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ูุงุฆูุฉ ุงูููุชุฌุงุช</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="glass-table-header">
        <tr>
         <th class="px-4 py-3 text-right text-white">ุงูููุชุฌ</th>
         <th class="px-4 py-3 text-right text-white">ุงูุชูููุฉ</th>
         <th class="px-4 py-3 text-right text-white">ูุณุชููู</th>
         <th class="px-4 py-3 text-right text-white">ุฌููุฉ</th>
         <th class="px-4 py-3 text-right text-white">ูุฑุชููุฉ</th>
         <th class="px-4 py-3 text-right text-white">ุงููุฎุฒูู</th>
         <th class="px-4 py-3 text-right text-white">ุฅุฌุฑุงุกุงุช</th>
        </tr>
       </thead>
       <tbody id="products-list">
        <tr class="glass-table-row">
         <td colspan="7" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ููุชุฌุงุช ุจุนุฏ</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div><!-- Inventory -->
   <div id="content-inventory" class="tab-content hidden">
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">โ๏ธ ุชูุจููุงุช ุงููุฎุฒูู</h2>
     <div id="inventory-alerts"></div>
    </div>
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ุญุฑูุฉ ุงููุฎุฒูู</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="glass-table-header">
        <tr>
         <th class="px-4 py-3 text-right text-white">ุงูุชุงุฑูุฎ</th>
         <th class="px-4 py-3 text-right text-white">ุงูููุชุฌ</th>
         <th class="px-4 py-3 text-right text-white">ุงูููุน</th>
         <th class="px-4 py-3 text-right text-white">ุงููููุฉ</th>
         <th class="px-4 py-3 text-right text-white">ุงูุฑุตูุฏ</th>
        </tr>
       </thead>
       <tbody id="inventory-movements">
        <tr class="glass-table-row">
         <td colspan="5" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ุญุฑูุงุช ุจุนุฏ</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div><!-- Accounts -->
   <div id="content-accounts" class="tab-content hidden">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-2xl mb-2">
       ๐ต
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุงูุตูุฏูู
      </div>
      <div class="text-2xl font-bold text-white" id="cash-balance">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-2xl mb-2">
       ๐ฆ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุงูุจูู
      </div>
      <div class="text-2xl font-bold text-white" id="bank-balance">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-2xl mb-2">
       ๐ฑ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ููุฏุงููู ูุงุด
      </div>
      <div class="text-2xl font-bold text-white" id="vodafone-balance">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-2xl mb-2">
       ๐ณ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุงูุณุชุง ุจุงู
      </div>
      <div class="text-2xl font-bold text-white" id="instapay-balance">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-red-400 text-2xl mb-2">
       ๐ฅ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุฐูู ุงูุนููุงุก
      </div>
      <div class="text-2xl font-bold text-white" id="customers-debt-balance">
       0 ุฌ.ู
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-red-400 text-2xl mb-2">
       ๐ญ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุฐูู ุงูููุฑุฏูู
      </div>
      <div class="text-2xl font-bold text-white" id="suppliers-debt-balance">
       0 ุฌ.ู
      </div>
     </div>
    </div>
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ุฏููู ุงูุญุณุงุจุงุช</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="glass-table-header">
        <tr>
         <th class="px-4 py-3 text-right text-white">ุงูุญุณุงุจ</th>
         <th class="px-4 py-3 text-right text-white">ุงูุฑุตูุฏ</th>
        </tr>
       </thead>
       <tbody>
        <tr class="glass-table-row">
         <td class="px-4 py-3 text-white">ุงูุตูุฏูู</td>
         <td class="px-4 py-3 text-white" id="cash-row">0 ุฌ.ู</td>
        </tr>
        <tr class="glass-table-row">
         <td class="px-4 py-3 text-white">ุงูุจูู</td>
         <td class="px-4 py-3 text-white" id="bank-row">0 ุฌ.ู</td>
        </tr>
        <tr class="glass-table-row">
         <td class="px-4 py-3 text-white">ููุฏุงููู ูุงุด</td>
         <td class="px-4 py-3 text-white" id="vodafone-row">0 ุฌ.ู</td>
        </tr>
        <tr class="glass-table-row">
         <td class="px-4 py-3 text-white">ุงูุณุชุง ุจุงู</td>
         <td class="px-4 py-3 text-white" id="instapay-row">0 ุฌ.ู</td>
        </tr>
        <tr class="glass-table-row">
         <td class="px-4 py-3 text-white">ุฐูู ุงูุนููุงุก</td>
         <td class="px-4 py-3 text-white" id="customers-debt-row">0 ุฌ.ู</td>
        </tr>
        <tr class="glass-table-row">
         <td class="px-4 py-3 text-white">ุฐูู ุงูููุฑุฏูู</td>
         <td class="px-4 py-3 text-white" id="suppliers-debt-row">0 ุฌ.ู</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div><!-- Reports -->
   <div id="content-reports" class="tab-content hidden">
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ูุงุฆูุฉ ุงูุฏุฎู</h2>
     <div class="space-y-4">
      <div class="flex justify-between items-center"><span class="text-slate-300">ุฅุฌูุงูู ุงููุจูุนุงุช</span> <span class="text-white font-bold" id="income-sales">0 ุฌ.ู</span>
      </div>
      <div class="flex justify-between items-center"><span class="text-slate-300">ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ (COGS)</span> <span class="text-red-400 font-bold" id="income-cogs">0 ุฌ.ู</span>
      </div>
      <hr class="border-slate-600">
      <div class="flex justify-between items-center"><span class="text-white font-bold">ูุฌูู ุงูุฑุจุญ</span> <span class="text-green-400 font-bold text-xl" id="income-gross">0 ุฌ.ู</span>
      </div>
      <div class="flex justify-between items-center"><span class="text-slate-300">ุงููุตุฑููุงุช</span> <span class="text-red-400 font-bold" id="income-expenses">0 ุฌ.ู</span>
      </div>
      <hr class="border-slate-600">
      <div class="flex justify-between items-center"><span class="text-white font-bold text-xl">ุตุงูู ุงูุฑุจุญ</span> <span class="text-green-400 font-bold text-2xl" id="income-net">0 ุฌ.ู</span>
      </div>
     </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
     <div class="glass-card rounded-2xl p-6">
      <h2 class="text-xl font-bold text-white mb-4">๐ ูุณุจ ุงูุฑุจุญูุฉ</h2>
      <div class="space-y-3">
       <div class="flex justify-between items-center"><span class="text-slate-300">ูุงูุด ุงูุฑุจุญ ุงูุฅุฌูุงูู</span> <span class="text-green-400 font-bold" id="gross-margin">0%</span>
       </div>
       <div class="flex justify-between items-center"><span class="text-slate-300">ูุงูุด ุงูุฑุจุญ ุงูุตุงูู</span> <span class="text-green-400 font-bold" id="net-margin">0%</span>
       </div>
      </div>
     </div>
     <div class="glass-card rounded-2xl p-6">
      <h2 class="text-xl font-bold text-white mb-4">โ๏ธ ููุทุฉ ุงูุชุนุงุฏู</h2>
      <div class="space-y-3">
       <div class="flex justify-between items-center"><span class="text-slate-300">ูุจูุนุงุช ุงูุชุนุงุฏู</span> <span class="text-yellow-400 font-bold" id="break-even">0 ุฌ.ู</span>
       </div>
      </div>
     </div>
    </div>
   </div><!-- CRM -->
   <div id="content-crm" class="tab-content hidden">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-3xl mb-2">
       ๐ฅ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุฅุฌูุงูู ุงูุนููุงุก
      </div>
      <div class="text-3xl font-bold text-white" id="crm-total-customers">
       0
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-green-400 text-3xl mb-2">
       โ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุนููุงุก ูุดุทูู
      </div>
      <div class="text-3xl font-bold text-white" id="crm-active-customers">
       0
      </div>
     </div>
     <div class="glass-stat-card rounded-2xl p-6">
      <div class="text-yellow-400 text-3xl mb-2">
       ๐ฏ
      </div>
      <div class="text-slate-300 text-sm mb-1">
       ุนููุงุก ูุญุชูููู
      </div>
      <div class="text-3xl font-bold text-white" id="crm-potential-customers">
       0
      </div>
     </div>
    </div><!-- Add Potential Customer -->
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">โ ุฅุถุงูุฉ ุนููู ูุญุชูู</h2>
     <form id="potential-customer-form" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุงุณู ุงูุนููู</label> <input type="text" id="potential-customer-name" class="glass-input w-full px-4 py-3 rounded-xl" required>
       </div>
       <div><label class="block text-slate-300 mb-2">ููุน ุงูุนููู</label> <select id="potential-customer-type" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="">ุงุฎุชุฑ ููุน ุงูุนููู</option> </select>
       </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
       <div><label class="block text-slate-300 mb-2">ุฑูู ุงููุงุชู</label> <input type="tel" id="potential-customer-phone" class="glass-input w-full px-4 py-3 rounded-xl" required>
       </div>
       <div><label class="block text-slate-300 mb-2">ุงููุญุตูู ุงูููุชู ุจู</label> <select id="potential-customer-crop" class="glass-input w-full px-4 py-3 rounded-xl"> <option value="">ุงุฎุชุฑ ูุญุตูู</option> </select>
       </div>
      </div>
      <div><label class="block text-slate-300 mb-2">ููุงุญุธุงุช</label> <textarea id="potential-customer-notes" class="glass-input w-full px-4 py-3 rounded-xl" rows="2"></textarea>
      </div><button type="submit" class="glass-button-primary w-full py-3 rounded-xl font-bold">๐พ ุญูุธ ุงูุนููู ุงููุญุชูู</button>
     </form>
    </div>
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">โ ุฅุถุงูุฉ ูุชุงุจุนุฉ</h2>
     <form id="follow-up-form" class="space-y-4">
      <div><label class="block text-slate-300 mb-2">ุงูุนููู</label> <select id="follow-up-customer" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="">ุงุฎุชุฑ ุนููู</option> </select>
      </div>
      <div><label class="block text-slate-300 mb-2">ููุน ุงููุชุงุจุนุฉ</label> <select id="follow-up-type" class="glass-input w-full px-4 py-3 rounded-xl" required> <option value="ููุงููุฉ">ููุงููุฉ</option> <option value="ุฒูุงุฑุฉ">ุฒูุงุฑุฉ</option> <option value="ุฑุณุงูุฉ">ุฑุณุงูุฉ</option> <option value="ุงุฌุชูุงุน">ุงุฌุชูุงุน</option> </select>
      </div>
      <div><label class="block text-slate-300 mb-2">ุงููุญุตูู</label> <select id="follow-up-crop" class="glass-input w-full px-4 py-3 rounded-xl"> <option value="">ุงุฎุชุฑ ูุญุตูู</option> </select>
      </div>
      <div><label class="block text-slate-300 mb-2">ุงูููุงุญุธุงุช</label> <textarea id="follow-up-notes" class="glass-input w-full px-4 py-3 rounded-xl" rows="3" required></textarea>
      </div><button type="submit" class="glass-button-primary w-full py-3 rounded-xl font-bold">๐พ ุญูุธ ุงููุชุงุจุนุฉ</button>
     </form>
    </div>
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ุณุฌู ุงููุชุงุจุนุงุช</h2>
     <div id="crm-notes"></div>
    </div>
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ุฃูุถู ุงูุนููุงุก</h2>
     <div class="overflow-x-auto">
      <table class="w-full">
       <thead class="glass-table-header">
        <tr>
         <th class="px-4 py-3 text-right text-white">ุงูุนููู</th>
         <th class="px-4 py-3 text-right text-white">ุนุฏุฏ ุงููุดุชุฑูุงุช</th>
         <th class="px-4 py-3 text-right text-white">ุฅุฌูุงูู ุงููุดุชุฑูุงุช</th>
         <th class="px-4 py-3 text-right text-white">ุขุฎุฑ ุชูุงุตู</th>
         <th class="px-4 py-3 text-right text-white">ุงูุญุงูุฉ</th>
        </tr>
       </thead>
       <tbody id="crm-top-customers">
        <tr class="glass-table-row">
         <td colspan="5" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ุจูุงูุงุช ุจุนุฏ</td>
        </tr>
       </tbody>
      </table>
     </div>
    </div>
   </div><!-- Settings -->
   <div id="content-settings" class="tab-content hidden">
    <div class="glass-card rounded-2xl p-6 mb-6">
     <h2 class="text-2xl font-bold text-white mb-4">โ๏ธ ุฅุนุฏุงุฏุงุช ุงููุธุงู</h2>
     <form id="settings-form" class="space-y-4">
      <div><label class="block text-slate-300 mb-2">ุงุณู ุงูุจุฑูุงูุฌ</label> <input type="text" id="setting-app-name" class="glass-input w-full px-4 py-3 rounded-xl" value="ูุณุงุนุฏ ุญุณุงุจุงุช">
      </div>
      <div><label class="block text-slate-300 mb-2">ุงุณู ุงูุดุฑูุฉ</label> <input type="text" id="setting-company-name" class="glass-input w-full px-4 py-3 rounded-xl">
      </div>
      <div><label class="block text-slate-300 mb-2">ุนููุงู ุงูุดุฑูุฉ</label> <input type="text" id="setting-company-address" class="glass-input w-full px-4 py-3 rounded-xl">
      </div>
      <div><label class="block text-slate-300 mb-2">ูุงุชู ุงูุดุฑูุฉ</label> <input type="tel" id="setting-company-phone" class="glass-input w-full px-4 py-3 rounded-xl">
      </div>
      <div><label class="block text-slate-300 mb-2">ุงูุนููุฉ</label> <select id="setting-currency" class="glass-input w-full px-4 py-3 rounded-xl"> <option value="ุฌ.ู">ุฌููู ูุตุฑู (ุฌ.ู)</option> <option value="ุฑ.ุณ">ุฑูุงู ุณุนูุฏู (ุฑ.ุณ)</option> <option value="ุฏ.ุฅ">ุฏุฑูู ุฅูุงุฑุงุชู (ุฏ.ุฅ)</option> <option value="$">ุฏููุงุฑ ($)</option> </select>
      </div>
      <div><label class="block text-slate-300 mb-2">ูุณุจุฉ ุงูุถุฑูุจุฉ (%)</label> <input type="number" id="setting-tax-rate" class="glass-input w-full px-4 py-3 rounded-xl" step="0.01" min="0">
      </div><button type="submit" class="glass-button-primary w-full py-3 rounded-xl font-bold">๐พ ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
     </form>
    </div><!-- Manage Lists -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6"><!-- Customer Types -->
     <div class="glass-card rounded-2xl p-6">
      <h3 class="text-xl font-bold text-white mb-4">ุฃููุงุน ุงูุนููุงุก</h3>
      <form id="customer-type-form" class="mb-4">
       <div class="flex gap-2"><input type="text" id="new-customer-type" class="glass-input flex-1 px-4 py-2 rounded-xl" placeholder="ููุน ุฌุฏูุฏ..."> <button type="submit" class="glass-button-primary px-4 py-2 rounded-xl">โ</button>
       </div>
      </form>
      <div id="customer-types-list" class="space-y-2"></div>
     </div><!-- Crops -->
     <div class="glass-card rounded-2xl p-6">
      <h3 class="text-xl font-bold text-white mb-4">ุงููุญุงุตูู</h3>
      <form id="crop-form" class="mb-4">
       <div class="flex gap-2"><input type="text" id="new-crop" class="glass-input flex-1 px-4 py-2 rounded-xl" placeholder="ูุญุตูู ุฌุฏูุฏ..."> <button type="submit" class="glass-button-primary px-4 py-2 rounded-xl">โ</button>
       </div>
      </form>
      <div id="crops-list" class="space-y-2"></div>
     </div><!-- Units -->
     <div class="glass-card rounded-2xl p-6">
      <h3 class="text-xl font-bold text-white mb-4">ูุญุฏุงุช ุงูููุงุณ</h3>
      <form id="unit-form" class="mb-4">
       <div class="flex gap-2"><input type="text" id="new-unit" class="glass-input flex-1 px-4 py-2 rounded-xl" placeholder="ูุญุฏุฉ ุฌุฏูุฏุฉ..."> <button type="submit" class="glass-button-primary px-4 py-2 rounded-xl">โ</button>
       </div>
      </form>
      <div id="units-list" class="space-y-2"></div>
     </div><!-- Expense Categories -->
     <div class="glass-card rounded-2xl p-6">
      <h3 class="text-xl font-bold text-white mb-4">ุฃููุงุน ุงููุตุฑููุงุช</h3>
      <form id="expense-category-form" class="mb-4">
       <div class="flex gap-2"><input type="text" id="new-expense-category" class="glass-input flex-1 px-4 py-2 rounded-xl" placeholder="ููุน ุฌุฏูุฏ..."> <button type="submit" class="glass-button-primary px-4 py-2 rounded-xl">โ</button>
       </div>
      </form>
      <div id="expense-categories-list" class="space-y-2"></div>
     </div>
    </div><!-- Backup -->
    <div class="glass-card rounded-2xl p-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐พ ุงููุณุฎ ุงูุงุญุชูุงุทู</h2>
     <div class="flex gap-3"><button onclick="exportBackup()" class="glass-button-primary flex-1 py-3 rounded-xl font-bold">๐ฅ ุชุตุฏูุฑ ูุณุฎุฉ ุงุญุชูุงุทูุฉ</button> <button onclick="showMessage('ููุฏ ุงูุชุทููุฑ', 'info')" class="glass-button-secondary flex-1 py-3 rounded-xl font-bold">๐ค ุงุณุชูุฑุงุฏ ูุณุฎุฉ ุงุญุชูุงุทูุฉ</button>
     </div>
    </div>
    <div class="glass-card rounded-2xl p-6 mt-6">
     <h2 class="text-2xl font-bold text-white mb-4">๐ ุฅุญุตุงุฆูุงุช ุงููุธุงู</h2>
     <div class="space-y-3">
      <div class="flex justify-between items-center"><span class="text-slate-300">ุฅุฌูุงูู ุงูุณุฌูุงุช</span> <span class="text-white font-bold" id="stats-total-records">0</span>
      </div>
      <div class="flex justify-between items-center"><span class="text-slate-300">ุงููุณุงุญุฉ ุงููุณุชุฎุฏูุฉ</span> <span class="text-white font-bold" id="stats-storage">0 / 999</span>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
        let allData = [];
        let currentTab = 'dashboard';
        let pendingAction = null;
        let invoiceCounter = 1;

        // Modal functions
        function showConfirmation(title, message, action) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            pendingAction = action;
            document.getElementById('confirmation-modal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('confirmation-modal').classList.add('hidden');
            pendingAction = null;
        }

        function confirmAction() {
            if (pendingAction) {
                pendingAction();
            }
            closeModal();
        }

        // Tab navigation
        function showTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(`content-${tabName}`).classList.remove('hidden');
            document.querySelectorAll('.glass-nav-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
        }

        // Generate invoice number
        function generateInvoiceNumber() {
            const date = new Date();
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `INV-${year}${month}${day}-${String(invoiceCounter++).padStart(4, '0')}`;
        }

        // Create Journal Entry (Double Entry)
        async function createJournalEntry(entries, referenceType, referenceId) {
            const totalDebit = entries.reduce((sum, e) => sum + (e.debit || 0), 0);
            const totalCredit = entries.reduce((sum, e) => sum + (e.credit || 0), 0);
            
            if (Math.abs(totalDebit - totalCredit) > 0.01) {
                console.error('Journal entry not balanced!', {totalDebit, totalCredit});
                return false;
            }

            const journalEntry = {
                type: 'journal_entry',
                date: new Date().toISOString(),
                entries: JSON.stringify(entries),
                totalDebit: totalDebit,
                totalCredit: totalCredit,
                referenceType: referenceType,
                referenceId: referenceId
            };

            const result = await window.dataSdk.create(journalEntry);
            return result.isOk;
        }

        // Calculate accounts from journal entries
        function calculateAccounts() {
            const accounts = {
                'ุงูุตูุฏูู': 0,
                'ุงูุจูู': 0,
                'ููุฏุงููู ูุงุด': 0,
                'ุงูุณุชุง ุจุงู': 0,
                'ุงูุนููุงุก (ุฐูู)': 0,
                'ุงูููุฑุฏูู (ุฐูู)': 0,
                'ุงููุจูุนุงุช': 0,
                'ุงููุดุชุฑูุงุช': 0,
                'ุงููุตุฑููุงุช': 0,
                'ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ': 0,
                'ุงููุฎุฒูู': 0
            };

            const journalEntries = allData.filter(d => d.type === 'journal_entry');
            journalEntries.forEach(je => {
                try {
                    const entries = JSON.parse(je.entries);
                    entries.forEach(e => {
                        if (accounts.hasOwnProperty(e.account)) {
                            accounts[e.account] += (e.debit || 0) - (e.credit || 0);
                        }
                    });
                } catch (error) {
                    console.error('Error parsing journal entry:', error);
                }
            });

            return accounts;
        }

        // Data handler
        const dataHandler = {
            onDataChanged(data) {
                allData = data;
                updateAllViews();
            }
        };

        // Initialize SDK
        (async () => {
            if (window.dataSdk) {
                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    console.error('Failed to initialize Data SDK');
                }
            }
        })();

        // Customer form
        document.getElementById('customer-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            const customer = {
                type: 'customer',
                name: document.getElementById('customer-name').value,
                customerType: document.getElementById('customer-type').value,
                phone: document.getElementById('customer-phone').value,
                phone2: document.getElementById('customer-phone2').value || '',
                phone3: document.getElementById('customer-phone3').value || '',
                crop1: document.getElementById('customer-crop1').value || '',
                crop2: document.getElementById('customer-crop2').value || '',
                address: document.getElementById('customer-address').value || '',
                currentDebt: 0,
                totalDebt: 0,
                totalPaid: 0,
                totalPurchases: 0,
                isPotential: false,
                status: 'ูุดุท',
                lastContact: new Date().toISOString()
            };
            const result = await window.dataSdk.create(customer);
            if (result.isOk) {
                e.target.reset();
                showMessage('ุชู ุฅุถุงูุฉ ุงูุนููู ุจูุฌุงุญ', 'success');
            }
        });

        // Potential customer form
        document.getElementById('potential-customer-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            const customer = {
                type: 'customer',
                name: document.getElementById('potential-customer-name').value,
                customerType: document.getElementById('potential-customer-type').value,
                phone: document.getElementById('potential-customer-phone').value,
                phone2: '',
                phone3: '',
                crop1: document.getElementById('potential-customer-crop').value || '',
                crop2: '',
                address: '',
                notes: document.getElementById('potential-customer-notes').value || '',
                currentDebt: 0,
                totalDebt: 0,
                totalPaid: 0,
                totalPurchases: 0,
                isPotential: true,
                status: 'ูุญุชูู',
                lastContact: new Date().toISOString()
            };
            const result = await window.dataSdk.create(customer);
            if (result.isOk) {
                e.target.reset();
                showMessage('ุชู ุฅุถุงูุฉ ุงูุนููู ุงููุญุชูู ุจูุฌุงุญ', 'success');
            }
        });

        // Supplier form
        document.getElementById('supplier-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            const supplier = {
                type: 'supplier',
                name: document.getElementById('supplier-name').value,
                phone: document.getElementById('supplier-phone').value,
                email: document.getElementById('supplier-email').value || '',
                address: document.getElementById('supplier-address').value || '',
                currentDebt: 0,
                totalDebt: 0,
                totalPaid: 0
            };
            const result = await window.dataSdk.create(supplier);
            if (result.isOk) {
                e.target.reset();
                showMessage('ุชู ุฅุถุงูุฉ ุงูููุฑุฏ ุจูุฌุงุญ', 'success');
            }
        });

        // Product form
        document.getElementById('product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            const product = {
                type: 'product',
                name: document.getElementById('product-name').value,
                costPrice: parseFloat(document.getElementById('product-cost').value),
                sellingPrice: parseFloat(document.getElementById('product-price').value),
                wholesalePrice: parseFloat(document.getElementById('product-wholesale').value),
                cartonWholesalePrice: parseFloat(document.getElementById('product-carton-wholesale').value),
                unitsPerCarton: parseInt(document.getElementById('product-units-per-carton').value),
                unit: document.getElementById('product-unit').value,
                currentStock: parseFloat(document.getElementById('product-current-stock').value),
                minStock: parseFloat(document.getElementById('product-min-stock').value)
            };
            const result = await window.dataSdk.create(product);
            if (result.isOk) {
                e.target.reset();
                showMessage('ุชู ุฅุถุงูุฉ ุงูููุชุฌ ุจูุฌุงุญ', 'success');
            }
        });

        // Sales form
        document.getElementById('sales-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const items = document.querySelectorAll('.sale-item');
            const customerId = document.getElementById('sale-customer').value;
            const customer = allData.find(c => c.__backendId === customerId);
            const paymentMethod = document.getElementById('sale-payment-method').value;
            const invoiceNumber = generateInvoiceNumber();
            
            if (!customer) {
                showMessage('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุนููู', 'error');
                return;
            }

            let grandTotal = 0;
            let totalCOGS = 0;
            const saleItems = [];

            // Validate and collect items
            for (const item of items) {
                const productId = item.querySelector('.sale-product').value;
                const quantity = parseFloat(item.querySelector('.sale-quantity').value);
                const price = parseFloat(item.querySelector('.sale-price').value);
                const discount = parseFloat(item.querySelector('.sale-discount').value) || 0;
                const product = allData.find(p => p.__backendId === productId);
                
                if (!product) {
                    showMessage('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููุชุฌ ุตุญูุญ', 'error');
                    return;
                }

                if (quantity > product.currentStock) {
                    showMessage(`ุงููููุฉ ุงููุชุงุญุฉ ูู ${product.name} ูู ${product.currentStock} ููุท`, 'error');
                    return;
                }

                const itemTotal = quantity * price * (1 - discount / 100);
                const itemCOGS = quantity * product.costPrice;
                
                grandTotal += itemTotal;
                totalCOGS += itemCOGS;

                saleItems.push({
                    productId,
                    product,
                    quantity,
                    price,
                    discount,
                    total: itemTotal,
                    cogs: itemCOGS
                });
            }

            if (allData.length + saleItems.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }

            // Save all items
            for (const saleItem of saleItems) {
                const sale = {
                    type: 'sale',
                    invoiceNumber: invoiceNumber,
                    customerId: customerId,
                    customerName: customer.name,
                    productId: saleItem.productId,
                    productName: saleItem.product.name,
                    quantity: saleItem.quantity,
                    price: saleItem.price,
                    discount: saleItem.discount,
                    total: saleItem.total,
                    paymentMethod: paymentMethod,
                    paymentStatus: paymentMethod === 'ุขุฌู' ? 'ูุนูู' : 'ูุฏููุน',
                    date: new Date().toISOString()
                };
                
                await window.dataSdk.create(sale);
                
                // Update product stock
                saleItem.product.currentStock -= saleItem.quantity;
                await window.dataSdk.update(saleItem.product);
            }

            // Update customer
            customer.totalPurchases = (customer.totalPurchases || 0) + grandTotal;
            customer.lastContact = new Date().toISOString();
            
            if (paymentMethod === 'ุขุฌู') {
                customer.currentDebt = (customer.currentDebt || 0) + grandTotal;
                customer.totalDebt = (customer.totalDebt || 0) + grandTotal;
            }
            
            await window.dataSdk.update(customer);

            // Create journal entry
            const entries = [];
            
            if (paymentMethod === 'ุขุฌู') {
                // ูู ุญ/ ุงูุนููุงุก (ุฐูู)
                entries.push({account: 'ุงูุนููุงุก (ุฐูู)', debit: grandTotal, credit: 0});
            } else {
                // ูู ุญ/ ุงูุตูุฏูู/ุงูุจูู/...
                const accountMap = {
                    'ููุฏู': 'ุงูุตูุฏูู',
                    'ุจูู': 'ุงูุจูู',
                    'ููุฏุงููู ูุงุด': 'ููุฏุงููู ูุงุด',
                    'ุงูุณุชุง ุจุงู': 'ุงูุณุชุง ุจุงู'
                };
                entries.push({account: accountMap[paymentMethod], debit: grandTotal, credit: 0});
            }
            
            // ุฅูู ุญ/ ุงููุจูุนุงุช
            entries.push({account: 'ุงููุจูุนุงุช', debit: 0, credit: grandTotal});
            
            // ูู ุญ/ ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ
            entries.push({account: 'ุชูููุฉ ุงูุจุถุงุนุฉ ุงููุจุงุนุฉ', debit: totalCOGS, credit: 0});
            
            // ุฅูู ุญ/ ุงููุฎุฒูู
            entries.push({account: 'ุงููุฎุฒูู', debit: 0, credit: totalCOGS});

            await createJournalEntry(entries, 'sale', invoiceNumber);

            e.target.reset();
            document.getElementById('sale-items').innerHTML = `
                <div class="sale-item glass-card p-4 rounded-xl mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                        <div>
                            <label class="block text-slate-300 mb-2">ุงูููุชุฌ</label>
                            <select class="sale-product glass-input w-full px-4 py-3 rounded-xl" required>
                                <option value="">ุงุฎุชุฑ ููุชุฌ</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-slate-300 mb-2">ุงููููุฉ</label>
                            <input type="number" class="sale-quantity glass-input w-full px-4 py-3 rounded-xl" min="1" step="0.01" required>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-slate-300 mb-2">ุงูุณุนุฑ</label>
                            <input type="number" class="sale-price glass-input w-full px-4 py-3 rounded-xl" step="0.01" required>
                        </div>
                        <div>
                            <label class="block text-slate-300 mb-2">ุงูุฎุตู %</label>
                            <input type="number" class="sale-discount glass-input w-full px-4 py-3 rounded-xl" min="0" max="100" step="0.01" value="0">
                        </div>
                        <div>
                            <label class="block text-slate-300 mb-2">ุงูุฅุฌูุงูู</label>
                            <input type="text" class="sale-item-total glass-input w-full px-4 py-3 rounded-xl" readonly>
                        </div>
                    </div>
                </div>
            `;
            updateProductSelects();
            showMessage('ุชู ุฅุถุงูุฉ ุงููุงุชูุฑุฉ ุจูุฌุงุญ', 'success');
        });

        // Purchase form
        document.getElementById('purchase-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const items = document.querySelectorAll('.purchase-item');
            const supplierId = document.getElementById('purchase-supplier').value;
            const supplier = allData.find(s => s.__backendId === supplierId);
            const paymentMethod = document.getElementById('purchase-payment-method').value;
            const invoiceNumber = generateInvoiceNumber();
            
            if (!supplier) {
                showMessage('ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ููุฑุฏ', 'error');
                return;
            }

            let grandTotal = 0;
            const purchaseItems = [];

            // Collect items
            for (const item of items) {
                const productName = item.querySelector('.purchase-product-name').value.trim();
                const quantity = parseFloat(item.querySelector('.purchase-quantity').value);
                const price = parseFloat(item.querySelector('.purchase-price').value);
                
                if (!productName) {
                    showMessage('ุงูุฑุฌุงุก ุฅุฏุฎุงู ุงุณู ุงูููุชุฌ', 'error');
                    return;
                }

                const itemTotal = quantity * price;
                grandTotal += itemTotal;

                purchaseItems.push({
                    productName,
                    quantity,
                    price,
                    total: itemTotal
                });
            }

            if (allData.length + purchaseItems.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }

            // Save all items
            for (const purchaseItem of purchaseItems) {
                const purchase = {
                    type: 'purchase',
                    invoiceNumber: invoiceNumber,
                    supplierId: supplierId,
                    supplierName: supplier.name,
                    productName: purchaseItem.productName,
                    quantity: purchaseItem.quantity,
                    price: purchaseItem.price,
                    total: purchaseItem.total,
                    paymentMethod: paymentMethod,
                    paymentStatus: paymentMethod === 'ุขุฌู' ? 'ูุนูู' : 'ูุฏููุน',
                    date: new Date().toISOString()
                };
                
                await window.dataSdk.create(purchase);
                
                // Update product stock if exists
                const product = allData.find(p => p.type === 'product' && p.name === purchaseItem.productName);
                if (product) {
                    product.currentStock = (product.currentStock || 0) + purchaseItem.quantity;
                    await window.dataSdk.update(product);
                }
            }

            // Update supplier
            if (paymentMethod === 'ุขุฌู') {
                supplier.currentDebt = (supplier.currentDebt || 0) + grandTotal;
                supplier.totalDebt = (supplier.totalDebt || 0) + grandTotal;
            }
            
            await window.dataSdk.update(supplier);

            // Create journal entry
            const entries = [];
            
            // ูู ุญ/ ุงููุดุชุฑูุงุช
            entries.push({account: 'ุงููุดุชุฑูุงุช', debit: grandTotal, credit: 0});
            
            if (paymentMethod === 'ุขุฌู') {
                // ุฅูู ุญ/ ุงูููุฑุฏูู (ุฐูู)
                entries.push({account: 'ุงูููุฑุฏูู (ุฐูู)', debit: 0, credit: grandTotal});
            } else {
                // ุฅูู ุญ/ ุงูุตูุฏูู/ุงูุจูู/...
                const accountMap = {
                    'ููุฏู': 'ุงูุตูุฏูู',
                    'ุจูู': 'ุงูุจูู',
                    'ููุฏุงููู ูุงุด': 'ููุฏุงููู ูุงุด',
                    'ุงูุณุชุง ุจุงู': 'ุงูุณุชุง ุจุงู'
                };
                entries.push({account: accountMap[paymentMethod], debit: 0, credit: grandTotal});
            }

            await createJournalEntry(entries, 'purchase', invoiceNumber);

            e.target.reset();
            document.getElementById('purchase-items').innerHTML = `
                <div class="purchase-item glass-card p-4 rounded-xl mb-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                        <div>
                            <label class="block text-slate-300 mb-2">ุงุณู ุงูููุชุฌ/ุงูุฎุงู</label>
                            <input type="text" class="purchase-product-name glass-input w-full px-4 py-3 rounded-xl" placeholder="ุฃุฏุฎู ุงุณู ุงูููุชุฌ" required>
                        </div>
                        <div>
                            <label class="block text-slate-300 mb-2">ุงููููุฉ</label>
                            <input type="number" class="purchase-quantity glass-input w-full px-4 py-3 rounded-xl" min="1" step="0.01" required>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-slate-300 mb-2">ุงูุณุนุฑ</label>
                            <input type="number" class="purchase-price glass-input w-full px-4 py-3 rounded-xl" step="0.01" required>
                        </div>
                        <div>
                            <label class="block text-slate-300 mb-2">ุงูุฅุฌูุงูู</label>
                            <input type="text" class="purchase-item-total glass-input w-full px-4 py-3 rounded-xl" readonly>
                        </div>
                    </div>
                </div>
            `;
            showMessage('ุชู ุฅุถุงูุฉ ุงููุงุชูุฑุฉ ุจูุฌุงุญ', 'success');
        });

        // Expense form
        document.getElementById('expense-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            
            const amount = parseFloat(document.getElementById('expense-amount').value);
            const paymentMethod = document.getElementById('expense-payment-method').value;
            
            const expense = {
                type: 'expense',
                category: document.getElementById('expense-category').value,
                description: document.getElementById('expense-description').value,
                amount: amount,
                paymentMethod: paymentMethod,
                date: new Date().toISOString()
            };
            
            const result = await window.dataSdk.create(expense);
            
            if (result.isOk) {
                // Create journal entry
                const accountMap = {
                    'ููุฏู': 'ุงูุตูุฏูู',
                    'ุจูู': 'ุงูุจูู',
                    'ููุฏุงููู ูุงุด': 'ููุฏุงููู ูุงุด',
                    'ุงูุณุชุง ุจุงู': 'ุงูุณุชุง ุจุงู'
                };
                
                const entries = [
                    {account: 'ุงููุตุฑููุงุช', debit: amount, credit: 0},
                    {account: accountMap[paymentMethod], debit: 0, credit: amount}
                ];
                
                await createJournalEntry(entries, 'expense', expense.__backendId);
                
                e.target.reset();
                showMessage('ุชู ุฅุถุงูุฉ ุงููุตุฑูู ุจูุฌุงุญ', 'success');
            }
        });

        // Payment form
        document.getElementById('payment-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            
            const paymentType = document.getElementById('payment-type').value;
            const entityId = document.getElementById('payment-entity').value;
            const amount = parseFloat(document.getElementById('payment-amount').value);
            const paymentMethod = document.getElementById('payment-method').value;
            const notes = document.getElementById('payment-notes').value;
            
            let entity;
            if (paymentType === 'customer') {
                entity = allData.find(c => c.type === 'customer' && c.__backendId === entityId);
                if (!entity || amount > entity.currentDebt) {
                    showMessage('ุงููุจูุบ ุฃูุจุฑ ูู ุงููุฏููููุฉ ุงูุญุงููุฉ', 'error');
                    return;
                }
            } else {
                entity = allData.find(s => s.type === 'supplier' && s.__backendId === entityId);
                if (!entity || amount > entity.currentDebt) {
                    showMessage('ุงููุจูุบ ุฃูุจุฑ ูู ุงููุฏููููุฉ ุงูุญุงููุฉ', 'error');
                    return;
                }
            }
            
            const payment = {
                type: paymentType === 'customer' ? 'customer_payment' : 'supplier_payment',
                entityId: entityId,
                entityName: entity.name,
                amount: amount,
                paymentMethod: paymentMethod,
                notes: notes,
                date: new Date().toISOString()
            };
            
            const result = await window.dataSdk.create(payment);
            
            if (result.isOk) {
                // Update entity debt
                entity.currentDebt -= amount;
                entity.totalPaid = (entity.totalPaid || 0) + amount;
                await window.dataSdk.update(entity);
                
                // Create journal entry
                const accountMap = {
                    'ููุฏู': 'ุงูุตูุฏูู',
                    'ุจูู': 'ุงูุจูู',
                    'ููุฏุงููู ูุงุด': 'ููุฏุงููู ูุงุด',
                    'ุงูุณุชุง ุจุงู': 'ุงูุณุชุง ุจุงู'
                };
                
                const entries = [];
                if (paymentType === 'customer') {
                    // ูู ุญ/ ุงูุตูุฏูู ุฅูู ุญ/ ุงูุนููุงุก (ุฐูู)
                    entries.push({account: accountMap[paymentMethod], debit: amount, credit: 0});
                    entries.push({account: 'ุงูุนููุงุก (ุฐูู)', debit: 0, credit: amount});
                } else {
                    // ูู ุญ/ ุงูููุฑุฏูู (ุฐูู) ุฅูู ุญ/ ุงูุตูุฏูู
                    entries.push({account: 'ุงูููุฑุฏูู (ุฐูู)', debit: amount, credit: 0});
                    entries.push({account: accountMap[paymentMethod], debit: 0, credit: amount});
                }
                
                await createJournalEntry(entries, 'payment', payment.__backendId);
                
                e.target.reset();
                showMessage('ุชู ุชุณุฌูู ุงูุณุฏุงุฏ ุจูุฌุงุญ', 'success');
            }
        });

        // Follow-up form
        document.getElementById('follow-up-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            const customerId = document.getElementById('follow-up-customer').value;
            const customer = allData.find(c => c.__backendId === customerId);
            
            if (customer) {
                const followUp = {
                    type: 'follow_up',
                    customerId: customerId,
                    customerName: customer.name,
                    followUpType: document.getElementById('follow-up-type').value,
                    crop1: document.getElementById('follow-up-crop').value || '',
                    notes: document.getElementById('follow-up-notes').value,
                    date: new Date().toISOString()
                };
                await window.dataSdk.create(followUp);
                
                customer.lastContact = new Date().toISOString();
                await window.dataSdk.update(customer);
                
                e.target.reset();
                showMessage('ุชู ุฅุถุงูุฉ ุงููุชุงุจุนุฉ ุจูุฌุงุญ', 'success');
            }
        });

        // Settings form
        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const existingSettings = allData.find(d => d.type === 'settings');
            const settings = {
                type: 'settings',
                appName: document.getElementById('setting-app-name').value,
                companyName: document.getElementById('setting-company-name').value,
                companyAddress: document.getElementById('setting-company-address').value,
                companyPhone: document.getElementById('setting-company-phone').value,
                currency: document.getElementById('setting-currency').value,
                taxRate: parseFloat(document.getElementById('setting-tax-rate').value) || 0
            };
            
            if (existingSettings) {
                Object.assign(existingSettings, settings);
                await window.dataSdk.update(existingSettings);
            } else {
                if (allData.length >= 999) {
                    showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                    return;
                }
                await window.dataSdk.create(settings);
            }
            
            // Update app name in header
            document.querySelector('header h1').textContent = `๐พ ${settings.appName}`;
            
            showMessage('ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช ุจูุฌุงุญ', 'success');
        });

        // Customer type form
        document.getElementById('customer-type-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            const value = document.getElementById('new-customer-type').value.trim();
            if (value) {
                await window.dataSdk.create({type: 'customer_type', value: value});
                document.getElementById('new-customer-type').value = '';
                showMessage('ุชู ุงูุฅุถุงูุฉ ุจูุฌุงุญ', 'success');
            }
        });

        // Crop form
        document.getElementById('crop-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            const value = document.getElementById('new-crop').value.trim();
            if (value) {
                await window.dataSdk.create({type: 'crop', value: value});
                document.getElementById('new-crop').value = '';
                showMessage('ุชู ุงูุฅุถุงูุฉ ุจูุฌุงุญ', 'success');
            }
        });

        // Unit form
        document.getElementById('unit-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            const value = document.getElementById('new-unit').value.trim();
            if (value) {
                await window.dataSdk.create({type: 'unit', value: value});
                document.getElementById('new-unit').value = '';
                showMessage('ุชู ุงูุฅุถุงูุฉ ุจูุฌุงุญ', 'success');
            }
        });

        // Expense category form
        document.getElementById('expense-category-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (allData.length >= 999) {
                showMessage('ุชู ุงููุตูู ููุญุฏ ุงูุฃูุตู (999 ุณุฌู)', 'error');
                return;
            }
            const value = document.getElementById('new-expense-category').value.trim();
            if (value) {
                await window.dataSdk.create({type: 'expense_category', value: value});
                document.getElementById('new-expense-category').value = '';
                showMessage('ุชู ุงูุฅุถุงูุฉ ุจูุฌุงุญ', 'success');
            }
        });

        // Add sale item
        function addSaleItem() {
            const container = document.getElementById('sale-items');
            const newItem = document.createElement('div');
            newItem.className = 'sale-item glass-card p-4 rounded-xl mb-4';
            newItem.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                    <div>
                        <label class="block text-slate-300 mb-2">ุงูููุชุฌ</label>
                        <select class="sale-product glass-input w-full px-4 py-3 rounded-xl" required>
                            <option value="">ุงุฎุชุฑ ููุชุฌ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-slate-300 mb-2">ุงููููุฉ</label>
                        <input type="number" class="sale-quantity glass-input w-full px-4 py-3 rounded-xl" min="1" step="0.01" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                    <div>
                        <label class="block text-slate-300 mb-2">ุงูุณุนุฑ</label>
                        <input type="number" class="sale-price glass-input w-full px-4 py-3 rounded-xl" step="0.01" required>
                    </div>
                    <div>
                        <label class="block text-slate-300 mb-2">ุงูุฎุตู %</label>
                        <input type="number" class="sale-discount glass-input w-full px-4 py-3 rounded-xl" min="0" max="100" step="0.01" value="0">
                    </div>
                    <div>
                        <label class="block text-slate-300 mb-2">ุงูุฅุฌูุงูู</label>
                        <input type="text" class="sale-item-total glass-input w-full px-4 py-3 rounded-xl" readonly>
                    </div>
                </div>
                <button type="button" onclick="removeSaleItem(this)" class="glass-button-secondary px-3 py-1 rounded-lg text-sm">๐๏ธ ุญุฐู ุงูุจูุฏ</button>
            `;
            container.appendChild(newItem);
            updateProductSelects();
        }

        function removeSaleItem(btn) {
            const items = document.querySelectorAll('.sale-item');
            if (items.length > 1) {
                btn.closest('.sale-item').remove();
                updateSaleGrandTotal();
            } else {
                showMessage('ูุฌุจ ุงูุงุญุชูุงุธ ุจุจูุฏ ูุงุญุฏ ุนูู ุงูุฃูู', 'error');
            }
        }

        // Add purchase item
        function addPurchaseItem() {
            const container = document.getElementById('purchase-items');
            const newItem = document.createElement('div');
            newItem.className = 'purchase-item glass-card p-4 rounded-xl mb-4';
            newItem.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                    <div>
                        <label class="block text-slate-300 mb-2">ุงุณู ุงูููุชุฌ/ุงูุฎุงู</label>
                        <input type="text" class="purchase-product-name glass-input w-full px-4 py-3 rounded-xl" placeholder="ุฃุฏุฎู ุงุณู ุงูููุชุฌ" required>
                    </div>
                    <div>
                        <label class="block text-slate-300 mb-2">ุงููููุฉ</label>
                        <input type="number" class="purchase-quantity glass-input w-full px-4 py-3 rounded-xl" min="1" step="0.01" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                    <div>
                        <label class="block text-slate-300 mb-2">ุงูุณุนุฑ</label>
                        <input type="number" class="purchase-price glass-input w-full px-4 py-3 rounded-xl" step="0.01" required>
                    </div>
                    <div>
                        <label class="block text-slate-300 mb-2">ุงูุฅุฌูุงูู</label>
                        <input type="text" class="purchase-item-total glass-input w-full px-4 py-3 rounded-xl" readonly>
                    </div>
                </div>
                <button type="button" onclick="removePurchaseItem(this)" class="glass-button-secondary px-3 py-1 rounded-lg text-sm">๐๏ธ ุญุฐู ุงูุจูุฏ</button>
            `;
            container.appendChild(newItem);
            attachPurchaseItemListeners(newItem);
        }

        function removePurchaseItem(btn) {
            const items = document.querySelectorAll('.purchase-item');
            if (items.length > 1) {
                btn.closest('.purchase-item').remove();
                updatePurchaseGrandTotal();
            } else {
                showMessage('ูุฌุจ ุงูุงุญุชูุงุธ ุจุจูุฏ ูุงุญุฏ ุนูู ุงูุฃูู', 'error');
            }
        }

        // Update sale grand total
        function updateSaleGrandTotal() {
            let grandTotal = 0;
            document.querySelectorAll('.sale-item').forEach(item => {
                const quantity = parseFloat(item.querySelector('.sale-quantity').value) || 0;
                const price = parseFloat(item.querySelector('.sale-price').value) || 0;
                const discount = parseFloat(item.querySelector('.sale-discount').value) || 0;
                const itemTotal = quantity * price * (1 - discount / 100);
                item.querySelector('.sale-item-total').value = `${itemTotal.toFixed(2)} ุฌ.ู`;
                grandTotal += itemTotal;
            });
            document.getElementById('sale-grand-total').textContent = `${grandTotal.toFixed(2)} ุฌ.ู`;
        }

        // Update purchase grand total
        function updatePurchaseGrandTotal() {
            let grandTotal = 0;
            document.querySelectorAll('.purchase-item').forEach(item => {
                const quantity = parseFloat(item.querySelector('.purchase-quantity').value) || 0;
                const price = parseFloat(item.querySelector('.purchase-price').value) || 0;
                const itemTotal = quantity * price;
                item.querySelector('.purchase-item-total').value = `${itemTotal.toFixed(2)} ุฌ.ู`;
                grandTotal += itemTotal;
            });
            document.getElementById('purchase-grand-total').textContent = `${grandTotal.toFixed(2)} ุฌ.ู`;
        }

        // Attach purchase item listeners
        function attachPurchaseItemListeners(item) {
            item.querySelector('.purchase-quantity').addEventListener('input', updatePurchaseGrandTotal);
            item.querySelector('.purchase-price').addEventListener('input', updatePurchaseGrandTotal);
        }

        // Customer search
        document.getElementById('sale-customer-search').addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const select = document.getElementById('sale-customer');
            const customers = allData.filter(d => d.type === 'customer');
            
            const filtered = customers.filter(c => 
                c.name.toLowerCase().includes(searchTerm) || 
                (c.phone && c.phone.includes(searchTerm))
            );
            
            select.innerHTML = '<option value="">ุงุฎุชุฑ ุนููู</option>' + 
                filtered.map(c => `<option value="${c.__backendId}">${c.name} - ${c.phone}</option>`).join('');
        });

        // Update payment options
        function updatePaymentOptions() {
            const paymentType = document.getElementById('payment-type').value;
            const entitySelect = document.getElementById('payment-entity');
            const label = document.getElementById('payment-entity-label');
            
            if (paymentType === 'customer') {
                label.textContent = 'ุงูุนููู';
                const customers = allData.filter(d => d.type === 'customer' && d.currentDebt > 0);
                entitySelect.innerHTML = '<option value="">ุงุฎุชุฑ ุนููู</option>' + 
                    customers.map(c => `<option value="${c.__backendId}">${c.name} - ${c.currentDebt.toFixed(2)} ุฌ.ู</option>`).join('');
            } else if (paymentType === 'supplier') {
                label.textContent = 'ุงูููุฑุฏ';
                const suppliers = allData.filter(d => d.type === 'supplier' && d.currentDebt > 0);
                entitySelect.innerHTML = '<option value="">ุงุฎุชุฑ ููุฑุฏ</option>' + 
                    suppliers.map(s => `<option value="${s.__backendId}">${s.name} - ${s.currentDebt.toFixed(2)} ุฌ.ู</option>`).join('');
            } else {
                entitySelect.innerHTML = '<option value="">ุงุฎุชุฑ ุงูุฌูุฉ</option>';
            }
        }

        // Update product selects
        function updateProductSelects() {
            const products = allData.filter(d => d.type === 'product');
            
            document.querySelectorAll('.sale-product').forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">ุงุฎุชุฑ ููุชุฌ</option>' + 
                    products.map(p => `<option value="${p.__backendId}">${p.name} - ${p.sellingPrice} ุฌ.ู (ูุชููุฑ: ${p.currentStock})</option>`).join('');
                select.value = currentValue;
                
                select.onchange = function() {
                    const product = products.find(p => p.__backendId === this.value);
                    if (product) {
                        const item = this.closest('.sale-item');
                        item.querySelector('.sale-price').value = product.sellingPrice;
                        item.querySelector('.sale-quantity').oninput = updateSaleGrandTotal;
                        item.querySelector('.sale-price').oninput = updateSaleGrandTotal;
                        item.querySelector('.sale-discount').oninput = updateSaleGrandTotal;
                        updateSaleGrandTotal();
                    }
                };
            });
        }

        // Update customer selects
        function updateCustomerSelects() {
            const customers = allData.filter(d => d.type === 'customer');
            
            const saleCustomer = document.getElementById('sale-customer');
            saleCustomer.innerHTML = '<option value="">ุงุฎุชุฑ ุนููู</option>' + 
                customers.map(c => `<option value="${c.__backendId}">${c.name} - ${c.phone}</option>`).join('');
            
            const followUpCustomer = document.getElementById('follow-up-customer');
            followUpCustomer.innerHTML = '<option value="">ุงุฎุชุฑ ุนููู</option>' + 
                customers.map(c => `<option value="${c.__backendId}">${c.name}</option>`).join('');
        }

        // Update supplier selects
        function updateSupplierSelects() {
            const suppliers = allData.filter(d => d.type === 'supplier');
            
            const purchaseSupplier = document.getElementById('purchase-supplier');
            purchaseSupplier.innerHTML = '<option value="">ุงุฎุชุฑ ููุฑุฏ</option>' + 
                suppliers.map(s => `<option value="${s.__backendId}">${s.name}</option>`).join('');
        }

        // Update dropdown selects
        function updateDropdownSelects() {
            const customerTypes = allData.filter(d => d.type === 'customer_type');
            const crops = allData.filter(d => d.type === 'crop');
            const units = allData.filter(d => d.type === 'unit');
            const expenseCategories = allData.filter(d => d.type === 'expense_category');
            
            // Customer types
            const customerTypeSelects = [
                document.getElementById('customer-type'),
                document.getElementById('potential-customer-type')
            ];
            customerTypeSelects.forEach(select => {
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">ุงุฎุชุฑ ููุน ุงูุนููู</option>' + 
                        customerTypes.map(ct => `<option value="${ct.value}">${ct.value}</option>`).join('');
                    select.value = currentValue;
                }
            });
            
            // Crops
            const cropSelects = [
                document.getElementById('customer-crop1'),
                document.getElementById('customer-crop2'),
                document.getElementById('potential-customer-crop'),
                document.getElementById('follow-up-crop')
            ];
            cropSelects.forEach(select => {
                if (select) {
                    const currentValue = select.value;
                    select.innerHTML = '<option value="">ุงุฎุชุฑ ูุญุตูู</option>' + 
                        crops.map(c => `<option value="${c.value}">${c.value}</option>`).join('');
                    select.value = currentValue;
                }
            });
            
            // Units
            const unitSelect = document.getElementById('product-unit');
            if (unitSelect) {
                const currentValue = unitSelect.value;
                unitSelect.innerHTML = '<option value="">ุงุฎุชุฑ ุงููุญุฏุฉ</option>' + 
                    units.map(u => `<option value="${u.value}">${u.value}</option>`).join('');
                unitSelect.value = currentValue;
            }
            
            // Expense categories
            const expenseCategorySelect = document.getElementById('expense-category');
            if (expenseCategorySelect) {
                const currentValue = expenseCategorySelect.value;
                expenseCategorySelect.innerHTML = '<option value="">ุงุฎุชุฑ ููุน ุงููุตุฑูู</option>' + 
                    expenseCategories.map(ec => `<option value="${ec.value}">${ec.value}</option>`).join('');
                expenseCategorySelect.value = currentValue;
            }
        }

        // Update all views
        function updateAllViews() {
            updateDashboard();
            updateCustomersList();
            updateSuppliersList();
            updateProductsList();
            updateSalesList();
            updatePurchasesList();
            updateExpensesList();
            updateReceivables();
            updatePaymentsList();
            updateInventory();
            updateAccounts();
            updateReports();
            updateCRM();
            updateFollowUps();
            updateSettings();
            updateSettingsLists();
            updateStats();
            updateCustomerSelects();
            updateSupplierSelects();
            updateProductSelects();
            updateDropdownSelects();
        }

        // Update dashboard
        function updateDashboard() {
            const sales = allData.filter(d => d.type === 'sale');
            const expenses = allData.filter(d => d.type === 'expense');
            const products = allData.filter(d => d.type === 'product');
            
            const totalSales = sales.reduce((sum, s) => sum + (s.total || 0), 0);
            
            // Calculate COGS correctly
            const costOfGoodsSold = sales.reduce((sum, s) => {
                const product = products.find(p => p.__backendId === s.productId);
                return sum + (product ? s.quantity * product.costPrice : 0);
            }, 0);
            
            const grossProfit = totalSales - costOfGoodsSold;
            const totalExpenses = expenses.reduce((sum, e) => sum + (e.amount || 0), 0);
            const netProfit = grossProfit - totalExpenses;
            
            // Calculate margins
            const grossMargin = totalSales > 0 ? (grossProfit / totalSales * 100).toFixed(1) : 0;
            const netMargin = totalSales > 0 ? (netProfit / totalSales * 100).toFixed(1) : 0;
            const breakEven = grossMargin > 0 ? (totalExpenses / (parseFloat(grossMargin) / 100)).toFixed(2) : 0;
            
            document.getElementById('dash-total-sales').textContent = `${totalSales.toFixed(2)} ุฌ.ู`;
            document.getElementById('dash-gross-profit').textContent = `${grossProfit.toFixed(2)} ุฌ.ู`;
            document.getElementById('dash-total-expenses').textContent = `${totalExpenses.toFixed(2)} ุฌ.ู`;
            document.getElementById('dash-net-profit').textContent = `${netProfit.toFixed(2)} ุฌ.ู`;
            document.getElementById('dash-gross-margin').textContent = `${grossMargin}%`;
            document.getElementById('dash-net-margin').textContent = `${netMargin}%`;
            document.getElementById('dash-break-even').textContent = `${breakEven} ุฌ.ู`;
            
            // Update accounts in dashboard
            const accounts = calculateAccounts();
            document.getElementById('dash-cash-balance').textContent = `${accounts['ุงูุตูุฏูู'].toFixed(2)} ุฌ.ู`;
            document.getElementById('dash-bank-balance').textContent = `${accounts['ุงูุจูู'].toFixed(2)} ุฌ.ู`;
            document.getElementById('dash-vodafone-balance').textContent = `${accounts['ููุฏุงููู ูุงุด'].toFixed(2)} ุฌ.ู`;
            document.getElementById('dash-instapay-balance').textContent = `${accounts['ุงูุณุชุง ุจุงู'].toFixed(2)} ุฌ.ู`;
            document.getElementById('dash-customers-debt').textContent = `${accounts['ุงูุนููุงุก (ุฐูู)'].toFixed(2)} ุฌ.ู`;
            document.getElementById('dash-suppliers-debt').textContent = `${accounts['ุงูููุฑุฏูู (ุฐูู)'].toFixed(2)} ุฌ.ู`;
        }

        // Update customers list
        function updateCustomersList() {
            const customers = allData.filter(d => d.type === 'customer' && !d.isPotential);
            const tbody = document.getElementById('customers-list');
            
            if (customers.length === 0) {
                tbody.innerHTML = '<tr class="glass-table-row"><td colspan="6" class="px-4 py-8 text-center text-slate-400">ูุง ููุฌุฏ ุนููุงุก ุจุนุฏ</td></tr>';
            } else {
                tbody.innerHTML = customers.map(c => {
                    const crops = [c.crop1, c.crop2].filter(cr => cr).join(', ') || '-';
                    const phones = [c.phone, c.phone2, c.phone3].filter(p => p);
                    const phoneLinks = phones.map(p => `<a href="tel:${p}" class="phone-link">${p}</a>`).join(', ');
                    
                    return `
                        <tr class="glass-table-row">
                            <td class="px-4 py-3 text-white">${c.name}</td>
                            <td class="px-4 py-3 text-white">${c.customerType || '-'}</td>
                            <td class="px-4 py-3 text-white">${phoneLinks}</td>
                            <td class="px-4 py-3 text-white">${crops}</td>
                            <td class="px-4 py-3 text-white">${c.address || '-'}</td>
                            <td class="px-4 py-3">
                                <button onclick="editCustomer('${c.__backendId}')" class="glass-button-primary px-2 py-1 rounded-lg text-xs mr-1">โ๏ธ</button>
                                <button onclick="newInvoiceForCustomer('${c.__backendId}')" class="glass-button-primary px-2 py-1 rounded-lg text-xs mr-1">๐</button>
                                <button onclick="confirmDeleteCustomer('${c.__backendId}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
        }

        // Update suppliers list
        function updateSuppliersList() {
            const suppliers = allData.filter(d => d.type === 'supplier');
            const tbody = document.getElementById('suppliers-list');
            
            if (suppliers.length === 0) {
                tbody.innerHTML = '<tr class="glass-table-row"><td colspan="5" class="px-4 py-8 text-center text-slate-400">ูุง ููุฌุฏ ููุฑุฏูู ุจุนุฏ</td></tr>';
            } else {
                tbody.innerHTML = suppliers.map(s => `
                    <tr class="glass-table-row">
                        <td class="px-4 py-3 text-white">${s.name}</td>
                        <td class="px-4 py-3 text-white"><a href="tel:${s.phone}" class="phone-link">${s.phone}</a></td>
                        <td class="px-4 py-3 text-white">${s.email || '-'}</td>
                        <td class="px-4 py-3 text-white">${s.address || '-'}</td>
                        <td class="px-4 py-3">
                            <button onclick="editSupplier('${s.__backendId}')" class="glass-button-primary px-2 py-1 rounded-lg text-xs mr-1">โ๏ธ</button>
                            <button onclick="confirmDeleteSupplier('${s.__backendId}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Update products list
        function updateProductsList() {
            const products = allData.filter(d => d.type === 'product');
            const tbody = document.getElementById('products-list');
            
            if (products.length === 0) {
                tbody.innerHTML = '<tr class="glass-table-row"><td colspan="7" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ููุชุฌุงุช ุจุนุฏ</td></tr>';
            } else {
                tbody.innerHTML = products.map(p => `
                    <tr class="glass-table-row">
                        <td class="px-4 py-3 text-white">${p.name}</td>
                        <td class="px-4 py-3 text-white">${p.costPrice.toFixed(2)}</td>
                        <td class="px-4 py-3 text-white">${p.sellingPrice.toFixed(2)}</td>
                        <td class="px-4 py-3 text-white">${p.wholesalePrice.toFixed(2)}</td>
                        <td class="px-4 py-3 text-white">${p.cartonWholesalePrice.toFixed(2)}</td>
                        <td class="px-4 py-3 text-white ${(p.currentStock || 0) <= p.minStock ? 'text-red-400' : 'text-green-400'}">${(p.currentStock || 0).toFixed(2)}</td>
                        <td class="px-4 py-3">
                            <button onclick="editProduct('${p.__backendId}')" class="glass-button-primary px-2 py-1 rounded-lg text-xs mr-1">โ๏ธ</button>
                            <button onclick="confirmDeleteProduct('${p.__backendId}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Update sales list
        function updateSalesList() {
            const sales = allData.filter(d => d.type === 'sale');
            
            // Group by invoice number
            const invoices = {};
            sales.forEach(s => {
                if (!invoices[s.invoiceNumber]) {
                    invoices[s.invoiceNumber] = {
                        invoiceNumber: s.invoiceNumber,
                        date: s.date,
                        customerName: s.customerName,
                        paymentMethod: s.paymentMethod,
                        total: 0
                    };
                }
                invoices[s.invoiceNumber].total += s.total;
            });
            
            const invoiceList = Object.values(invoices).sort((a, b) => new Date(b.date) - new Date(a.date));
            const tbody = document.getElementById('sales-list');
            
            if (invoiceList.length === 0) {
                tbody.innerHTML = '<tr class="glass-table-row"><td colspan="6" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ูุจูุนุงุช ุจุนุฏ</td></tr>';
            } else {
                tbody.innerHTML = invoiceList.map(inv => `
                    <tr class="glass-table-row">
                        <td class="px-4 py-3 text-white">${inv.invoiceNumber}</td>
                        <td class="px-4 py-3 text-white">${new Date(inv.date).toLocaleDateString('ar-EG')}</td>
                        <td class="px-4 py-3 text-white">${inv.customerName}</td>
                        <td class="px-4 py-3 text-white">${inv.total.toFixed(2)} ุฌ.ู</td>
                        <td class="px-4 py-3 text-white">${inv.paymentMethod}</td>
                        <td class="px-4 py-3">
                            <button onclick="viewInvoice('${inv.invoiceNumber}')" class="glass-button-primary px-2 py-1 rounded-lg text-xs mr-1">๐๏ธ</button>
                            <button onclick="confirmReturnSale('${inv.invoiceNumber}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">โฉ๏ธ</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Update purchases list
        function updatePurchasesList() {
            const purchases = allData.filter(d => d.type === 'purchase');
            
            // Group by invoice number
            const invoices = {};
            purchases.forEach(p => {
                if (!invoices[p.invoiceNumber]) {
                    invoices[p.invoiceNumber] = {
                        invoiceNumber: p.invoiceNumber,
                        date: p.date,
                        supplierName: p.supplierName,
                        paymentMethod: p.paymentMethod,
                        total: 0
                    };
                }
                invoices[p.invoiceNumber].total += p.total;
            });
            
            const invoiceList = Object.values(invoices).sort((a, b) => new Date(b.date) - new Date(a.date));
            const tbody = document.getElementById('purchases-list');
            
            if (invoiceList.length === 0) {
                tbody.innerHTML = '<tr class="glass-table-row"><td colspan="6" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ูุดุชุฑูุงุช ุจุนุฏ</td></tr>';
            } else {
                tbody.innerHTML = invoiceList.map(inv => `
                    <tr class="glass-table-row">
                        <td class="px-4 py-3 text-white">${inv.invoiceNumber}</td>
                        <td class="px-4 py-3 text-white">${new Date(inv.date).toLocaleDateString('ar-EG')}</td>
                        <td class="px-4 py-3 text-white">${inv.supplierName}</td>
                        <td class="px-4 py-3 text-white">${inv.total.toFixed(2)} ุฌ.ู</td>
                        <td class="px-4 py-3 text-white">${inv.paymentMethod}</td>
                        <td class="px-4 py-3">
                            <button onclick="viewPurchaseInvoice('${inv.invoiceNumber}')" class="glass-button-primary px-2 py-1 rounded-lg text-xs mr-1">๐๏ธ</button>
                            <button onclick="confirmDeletePurchase('${inv.invoiceNumber}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Update expenses list
        function updateExpensesList() {
            const expenses = allData.filter(d => d.type === 'expense');
            const tbody = document.getElementById('expenses-list');
            
            if (expenses.length === 0) {
                tbody.innerHTML = '<tr class="glass-table-row"><td colspan="6" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ูุตุฑููุงุช ุจุนุฏ</td></tr>';
            } else {
                tbody.innerHTML = expenses.map(e => `
                    <tr class="glass-table-row">
                        <td class="px-4 py-3 text-white">${new Date(e.date).toLocaleDateString('ar-EG')}</td>
                        <td class="px-4 py-3 text-white">${e.category}</td>
                        <td class="px-4 py-3 text-white">${e.description}</td>
                        <td class="px-4 py-3 text-white">${e.amount.toFixed(2)} ุฌ.ู</td>
                        <td class="px-4 py-3 text-white">${e.paymentMethod}</td>
                        <td class="px-4 py-3">
                            <button onclick="confirmDeleteExpense('${e.__backendId}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Update receivables
        function updateReceivables() {
            const customers = allData.filter(d => d.type === 'customer' && d.currentDebt > 0);
            const suppliers = allData.filter(d => d.type === 'supplier' && d.currentDebt > 0);
            
            const customerTbody = document.getElementById('customer-receivables-list');
            if (customers.length === 0) {
                customerTbody.innerHTML = '<tr class="glass-table-row"><td colspan="3" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ุฐูู</td></tr>';
            } else {
                customerTbody.innerHTML = customers.map(c => `
                    <tr class="glass-table-row">
                        <td class="px-4 py-3 text-white">${c.name}</td>
                        <td class="px-4 py-3 text-red-400 font-bold">${c.currentDebt.toFixed(2)} ุฌ.ู</td>
                        <td class="px-4 py-3">
                            <button onclick="payDebt('customer', '${c.__backendId}')" class="glass-button-primary px-2 py-1 rounded-lg text-xs">๐ฐ ุณุฏุงุฏ</button>
                        </td>
                    </tr>
                `).join('');
            }
            
            const supplierTbody = document.getElementById('supplier-payables-list');
            if (suppliers.length === 0) {
                supplierTbody.innerHTML = '<tr class="glass-table-row"><td colspan="3" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ุฐูู</td></tr>';
            } else {
                supplierTbody.innerHTML = suppliers.map(s => `
                    <tr class="glass-table-row">
                        <td class="px-4 py-3 text-white">${s.name}</td>
                        <td class="px-4 py-3 text-red-400 font-bold">${s.currentDebt.toFixed(2)} ุฌ.ู</td>
                        <td class="px-4 py-3">
                            <button onclick="payDebt('supplier', '${s.__backendId}')" class="glass-button-primary px-2 py-1 rounded-lg text-xs">๐ฐ ุณุฏุงุฏ</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Update payments list
        function updatePaymentsList() {
            const payments = allData.filter(d => d.type === 'customer_payment' || d.type === 'supplier_payment');
            const tbody = document.getElementById('payments-list');
            
            if (payments.length === 0) {
                tbody.innerHTML = '<tr class="glass-table-row"><td colspan="6" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ุณุฏุงุฏุงุช ุจุนุฏ</td></tr>';
            } else {
                tbody.innerHTML = payments.map(p => `
                    <tr class="glass-table-row">
                        <td class="px-4 py-3 text-white">${new Date(p.date).toLocaleDateString('ar-EG')}</td>
                        <td class="px-4 py-3 text-white">${p.type === 'customer_payment' ? 'ูู ุนููู' : 'ูููุฑุฏ'}</td>
                        <td class="px-4 py-3 text-white">${p.entityName}</td>
                        <td class="px-4 py-3 text-green-400 font-bold">${p.amount.toFixed(2)} ุฌ.ู</td>
                        <td class="px-4 py-3 text-white">${p.paymentMethod}</td>
                        <td class="px-4 py-3">
                            <button onclick="confirmDeletePayment('${p.__backendId}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        // Update inventory
        function updateInventory() {
            const products = allData.filter(d => d.type === 'product');
            const lowStockProducts = products.filter(p => (p.currentStock || 0) <= p.minStock);
            
            const alertsDiv = document.getElementById('inventory-alerts');
            if (lowStockProducts.length === 0) {
                alertsDiv.innerHTML = '<p class="text-slate-400 text-center py-4">ูุง ุชูุฌุฏ ุชูุจููุงุช</p>';
            } else {
                alertsDiv.innerHTML = lowStockProducts.map(p => `
                    <div class="glass-card rounded-xl p-4 flex justify-between items-center mb-3">
                        <div>
                            <div class="text-white font-bold">${p.name}</div>
                            <div class="text-slate-300 text-sm">ุงููููุฉ ุงูุญุงููุฉ: ${(p.currentStock || 0).toFixed(2)} ${p.unit} (ุงูุญุฏ ุงูุฃุฏูู: ${p.minStock})</div>
                        </div>
                        <div class="text-red-400 text-2xl">โ๏ธ</div>
                    </div>
                `).join('');
            }
            
            const sales = allData.filter(d => d.type === 'sale');
            const purchases = allData.filter(d => d.type === 'purchase');
            const movements = [];
            
            sales.forEach(s => {
                movements.push({
                    date: s.date,
                    productName: s.productName,
                    type: 'ูุจูุนุงุช',
                    quantity: -s.quantity
                });
            });
            
            purchases.forEach(p => {
                movements.push({
                    date: p.date,
                    productName: p.productName,
                    type: 'ูุดุชุฑูุงุช',
                    quantity: p.quantity
                });
            });
            
            movements.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const movementsTbody = document.getElementById('inventory-movements');
            if (movements.length === 0) {
                movementsTbody.innerHTML = '<tr class="glass-table-row"><td colspan="5" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ุญุฑูุงุช ุจุนุฏ</td></tr>';
            } else {
                movementsTbody.innerHTML = movements.slice(0, 50).map(m => `
                    <tr class="glass-table-row">
                        <td class="px-4 py-3 text-white">${new Date(m.date).toLocaleDateString('ar-EG')}</td>
                        <td class="px-4 py-3 text-white">${m.productName}</td>
                        <td class="px-4 py-3 text-white">${m.type}</td>
                        <td class="px-4 py-3 ${m.quantity > 0 ? 'text-green-400' : 'text-red-400'}">${m.quantity > 0 ? '+' : ''}${m.quantity.toFixed(2)}</td>
                        <td class="px-4 py-3 text-white">-</td>
                    </tr>
                `).join('');
            }
        }

        // Update accounts
        function updateAccounts() {
            const accounts = calculateAccounts();
            
            document.getElementById('cash-balance').textContent = `${accounts['ุงูุตูุฏูู'].toFixed(2)} ุฌ.ู`;
            document.getElementById('bank-balance').textContent = `${accounts['ุงูุจูู'].toFixed(2)} ุฌ.ู`;
            document.getElementById('vodafone-balance').textContent = `${accounts['ููุฏุงููู ูุงุด'].toFixed(2)} ุฌ.ู`;
            document.getElementById('instapay-balance').textContent = `${accounts['ุงูุณุชุง ุจุงู'].toFixed(2)} ุฌ.ู`;
            document.getElementById('customers-debt-balance').textContent = `${accounts['ุงูุนููุงุก (ุฐูู)'].toFixed(2)} ุฌ.ู`;
            document.getElementById('suppliers-debt-balance').textContent = `${accounts['ุงูููุฑุฏูู (ุฐูู)'].toFixed(2)} ุฌ.ู`;
            
            document.getElementById('cash-row').textContent = `${accounts['ุงูุตูุฏูู'].toFixed(2)} ุฌ.ู`;
            document.getElementById('bank-row').textContent = `${accounts['ุงูุจูู'].toFixed(2)} ุฌ.ู`;
            document.getElementById('vodafone-row').textContent = `${accounts['ููุฏุงููู ูุงุด'].toFixed(2)} ุฌ.ู`;
            document.getElementById('instapay-row').textContent = `${accounts['ุงูุณุชุง ุจุงู'].toFixed(2)} ุฌ.ู`;
            document.getElementById('customers-debt-row').textContent = `${accounts['ุงูุนููุงุก (ุฐูู)'].toFixed(2)} ุฌ.ู`;
            document.getElementById('suppliers-debt-row').textContent = `${accounts['ุงูููุฑุฏูู (ุฐูู)'].toFixed(2)} ุฌ.ู`;
        }

        // Update reports
        function updateReports() {
            const sales = allData.filter(d => d.type === 'sale');
            const expenses = allData.filter(d => d.type === 'expense');
            const products = allData.filter(d => d.type === 'product');
            
            const totalSales = sales.reduce((sum, s) => sum + (s.total || 0), 0);
            
            // Calculate COGS correctly
            const costOfGoodsSold = sales.reduce((sum, s) => {
                const product = products.find(p => p.__backendId === s.productId);
                return sum + (product ? s.quantity * product.costPrice : 0);
            }, 0);
            
            const grossProfit = totalSales - costOfGoodsSold;
            const totalExpenses = expenses.reduce((sum, e) => sum + (e.amount || 0), 0);
            const netProfit = grossProfit - totalExpenses;
            
            const grossMargin = totalSales > 0 ? (grossProfit / totalSales * 100).toFixed(1) : 0;
            const netMargin = totalSales > 0 ? (netProfit / totalSales * 100).toFixed(1) : 0;
            const breakEven = grossMargin > 0 ? (totalExpenses / (parseFloat(grossMargin) / 100)).toFixed(2) : 0;
            
            document.getElementById('income-sales').textContent = `${totalSales.toFixed(2)} ุฌ.ู`;
            document.getElementById('income-cogs').textContent = `${costOfGoodsSold.toFixed(2)} ุฌ.ู`;
            document.getElementById('income-gross').textContent = `${grossProfit.toFixed(2)} ุฌ.ู`;
            document.getElementById('income-expenses').textContent = `${totalExpenses.toFixed(2)} ุฌ.ู`;
            document.getElementById('income-net').textContent = `${netProfit.toFixed(2)} ุฌ.ู`;
            document.getElementById('gross-margin').textContent = `${grossMargin}%`;
            document.getElementById('net-margin').textContent = `${netMargin}%`;
            document.getElementById('break-even').textContent = `${breakEven} ุฌ.ู`;
        }

        // Update CRM
        function updateCRM() {
            const customers = allData.filter(d => d.type === 'customer');
            const activeCustomers = customers.filter(c => !c.isPotential && c.totalPurchases > 0);
            const potentialCustomers = customers.filter(c => c.isPotential);
            
            document.getElementById('crm-total-customers').textContent = customers.length;
            document.getElementById('crm-active-customers').textContent = activeCustomers.length;
           // ูุฐุง ุงูุฌุฒุก ููุถุงู ูู ููุงูุฉ ุงูู <script> ุจุนุฏ ุงูุณุทุฑ ุงูููุทูุน:

// ุฅููุงู updateCRM()
document.getElementById('crm-potential-customers').textContent = potentialCustomers.length;

// Update top customers
const topCustomers = activeCustomers
    .sort((a, b) => (b.totalPurchases || 0) - (a.totalPurchases || 0))
    .slice(0, 10);

const tbody = document.getElementById('crm-top-customers');
if (topCustomers.length === 0) {
    tbody.innerHTML = '<tr class="glass-table-row"><td colspan="5" class="px-4 py-8 text-center text-slate-400">ูุง ุชูุฌุฏ ุจูุงูุงุช ุจุนุฏ</td></tr>';
} else {
    tbody.innerHTML = topCustomers.map(c => {
        const sales = allData.filter(s => s.type === 'sale' && s.customerId === c.__backendId);
        const lastContact = c.lastContact ? new Date(c.lastContact).toLocaleDateString('ar-EG') : '-';
        const status = (c.totalPurchases || 0) > 0 ? 'โ ูุดุท' : 'โธ๏ธ ุบูุฑ ูุดุท';
        
        return `
            <tr class="glass-table-row">
                <td class="px-4 py-3 text-white">${c.name}</td>
                <td class="px-4 py-3 text-white">${sales.length}</td>
                <td class="px-4 py-3 text-green-400 font-bold">${(c.totalPurchases || 0).toFixed(2)} ุฌ.ู</td>
                <td class="px-4 py-3 text-white">${lastContact}</td>
                <td class="px-4 py-3 text-white">${status}</td>
            </tr>
        `;
    }).join('');
}
}

// Update follow-ups
function updateFollowUps() {
    const followUps = allData.filter(d => d.type === 'follow_up')
        .sort((a, b) => new Date(b.date) - new Date(a.date));
    
    const container = document.getElementById('crm-notes');
    if (followUps.length === 0) {
        container.innerHTML = '<p class="text-slate-400 text-center py-4">ูุง ุชูุฌุฏ ูุชุงุจุนุงุช ุจุนุฏ</p>';
    } else {
        container.innerHTML = followUps.slice(0, 20).map(f => `
            <div class="glass-card rounded-xl p-4 mb-3">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <div class="text-white font-bold">${f.customerName}</div>
                        <div class="text-slate-300 text-sm">${new Date(f.date).toLocaleDateString('ar-EG')} - ${f.followUpType}</div>
                    </div>
                    <button onclick="deleteFollowUp('${f.__backendId}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
                </div>
                <div class="text-slate-300 text-sm">${f.notes}</div>
                ${f.crop1 ? `<div class="text-green-400 text-xs mt-2">๐พ ${f.crop1}</div>` : ''}
            </div>
        `).join('');
    }
}

// Update settings
function updateSettings() {
    const settings = allData.find(d => d.type === 'settings');
    if (settings) {
        document.getElementById('setting-app-name').value = settings.appName || 'ูุณุงุนุฏ ุญุณุงุจุงุช';
        document.getElementById('setting-company-name').value = settings.companyName || '';
        document.getElementById('setting-company-address').value = settings.companyAddress || '';
        document.getElementById('setting-company-phone').value = settings.companyPhone || '';
        document.getElementById('setting-currency').value = settings.currency || 'ุฌ.ู';
        document.getElementById('setting-tax-rate').value = settings.taxRate || 0;
    }
}

// Update settings lists
function updateSettingsLists() {
    // Customer types
    const customerTypes = allData.filter(d => d.type === 'customer_type');
    const customerTypesDiv = document.getElementById('customer-types-list');
    customerTypesDiv.innerHTML = customerTypes.map(ct => `
        <div class="flex justify-between items-center p-2 glass-table-row rounded-lg">
            <span class="text-white">${ct.value}</span>
            <button onclick="deleteListItem('${ct.__backendId}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
        </div>
    `).join('');

    // Crops
    const crops = allData.filter(d => d.type === 'crop');
    const cropsDiv = document.getElementById('crops-list');
    cropsDiv.innerHTML = crops.map(c => `
        <div class="flex justify-between items-center p-2 glass-table-row rounded-lg">
            <span class="text-white">${c.value}</span>
            <button onclick="deleteListItem('${c.__backendId}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
        </div>
    `).join('');

    // Units
    const units = allData.filter(d => d.type === 'unit');
    const unitsDiv = document.getElementById('units-list');
    unitsDiv.innerHTML = units.map(u => `
        <div class="flex justify-between items-center p-2 glass-table-row rounded-lg">
            <span class="text-white">${u.value}</span>
            <button onclick="deleteListItem('${u.__backendId}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
        </div>
    `).join('');

    // Expense categories
    const expenseCategories = allData.filter(d => d.type === 'expense_category');
    const expenseCategoriesDiv = document.getElementById('expense-categories-list');
    expenseCategoriesDiv.innerHTML = expenseCategories.map(ec => `
        <div class="flex justify-between items-center p-2 glass-table-row rounded-lg">
            <span class="text-white">${ec.value}</span>
            <button onclick="deleteListItem('${ec.__backendId}')" class="glass-button-secondary px-2 py-1 rounded-lg text-xs">๐๏ธ</button>
        </div>
    `).join('');
}

// Update stats
function updateStats() {
    const totalRecords = allData.length;
    document.getElementById('stats-total-records').textContent = totalRecords;
    document.getElementById('stats-storage').textContent = `${totalRecords} / 999`;
}

// Show message (Toast)
function showMessage(message, type) {
    const toast = document.createElement('div');
    toast.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 2rem;
        border-radius: 0.5rem;
        color: white;
        z-index: 10000;
        animation: slideIn 0.3s ease-out;
        font-weight: bold;
    `;
    
    if (type === 'success') {
        toast.style.background = 'rgba(16, 185, 129, 0.95)';
    } else if (type === 'error') {
        toast.style.background = 'rgba(239, 68, 68, 0.95)';
    } else {
        toast.style.background = 'rgba(59, 130, 246, 0.95)';
    }
    
    toast.textContent = message;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// Export backup
function exportBackup() {
    const dataStr = JSON.stringify(allData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    showMessage('ุชู ุชุตุฏูุฑ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ', 'success');
}

// Edit customer
function editCustomer(id) {
    showMessage('ูุธููุฉ ุงูุชุนุฏูู ููุฏ ุงูุชุทููุฑ', 'info');
}

// Edit supplier
function editSupplier(id) {
    showMessage('ูุธููุฉ ุงูุชุนุฏูู ููุฏ ุงูุชุทููุฑ', 'info');
}

// Edit product
function editProduct(id) {
    showMessage('ูุธููุฉ ุงูุชุนุฏูู ููุฏ ุงูุชุทููุฑ', 'info');
}

// New invoice for customer
function newInvoiceForCustomer(id) {
    showTab('sales');
    setTimeout(() => {
        document.getElementById('sale-customer').value = id;
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 100);
}

// Pay debt
function payDebt(type, id) {
    showTab('receivables');
    setTimeout(() => {
        document.getElementById('payment-type').value = type;
        updatePaymentOptions();
        document.getElementById('payment-entity').value = id;
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 100);
}

// View invoice
function viewInvoice(invoiceNumber) {
    const sales = allData.filter(s => s.type === 'sale' && s.invoiceNumber === invoiceNumber);
    if (sales.length === 0) return;
    
    let content = `<h3 class="text-xl font-bold mb-4">ูุงุชูุฑุฉ ุฑูู: ${invoiceNumber}</h3>`;
    content += `<p class="mb-2">ุงูุนููู: ${sales[0].customerName}</p>`;
    content += `<p class="mb-4">ุงูุชุงุฑูุฎ: ${new Date(sales[0].date).toLocaleDateString('ar-EG')}</p>`;
    content += '<table class="w-full"><thead><tr><th class="text-right">ุงูููุชุฌ</th><th class="text-right">ุงููููุฉ</th><th class="text-right">ุงูุณุนุฑ</th><th class="text-right">ุงูุฅุฌูุงูู</th></tr></thead><tbody>';
    
    let total = 0;
    sales.forEach(s => {
        content += `<tr><td>${s.productName}</td><td>${s.quantity}</td><td>${s.price}</td><td>${s.total.toFixed(2)}</td></tr>`;
        total += s.total;
    });
    
    content += `</tbody></table><p class="text-xl font-bold mt-4">ุงูุฅุฌูุงูู: ${total.toFixed(2)} ุฌ.ู</p>`;
    
    showModal('ุชูุงุตูู ุงููุงุชูุฑุฉ', content, () => {});
}

// View purchase invoice
function viewPurchaseInvoice(invoiceNumber) {
    const purchases = allData.filter(p => p.type === 'purchase' && p.invoiceNumber === invoiceNumber);
    if (purchases.length === 0) return;
    
    let content = `<h3 class="text-xl font-bold mb-4">ูุงุชูุฑุฉ ุดุฑุงุก ุฑูู: ${invoiceNumber}</h3>`;
    content += `<p class="mb-2">ุงูููุฑุฏ: ${purchases[0].supplierName}</p>`;
    content += `<p class="mb-4">ุงูุชุงุฑูุฎ: ${new Date(purchases[0].date).toLocaleDateString('ar-EG')}</p>`;
    content += '<table class="w-full"><thead><tr><th class="text-right">ุงูููุชุฌ</th><th class="text-right">ุงููููุฉ</th><th class="text-right">ุงูุณุนุฑ</th><th class="text-right">ุงูุฅุฌูุงูู</th></tr></thead><tbody>';
    
    let total = 0;
    purchases.forEach(p => {
        content += `<tr><td>${p.productName}</td><td>${p.quantity}</td><td>${p.price}</td><td>${p.total.toFixed(2)}</td></tr>`;
        total += p.total;
    });
    
    content += `</tbody></table><p class="text-xl font-bold mt-4">ุงูุฅุฌูุงูู: ${total.toFixed(2)} ุฌ.ู</p>`;
    
    showModal('ุชูุงุตูู ูุงุชูุฑุฉ ุงูุดุฑุงุก', content, () => {});
}

// Confirm delete functions
async function confirmDeleteCustomer(id) {
    const item = allData.find(d => d.__backendId === id);
    if (!item) return;
    
    showConfirmation('ุชุฃููุฏ ุงูุญุฐู', `ูู ุชุฑูุฏ ุญุฐู ุงูุนููู "${item.name}"ุ`, async () => {
        const result = await window.dataSdk.delete(item);
        if (result.isOk) {
            showMessage('ุชู ุงูุญุฐู ุจูุฌุงุญ', 'success');
        } else {
            showMessage('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู', 'error');
        }
    });
}

async function confirmDeleteSupplier(id) {
    const item = allData.find(d => d.__backendId === id);
    if (!item) return;
    
    showConfirmation('ุชุฃููุฏ ุงูุญุฐู', `ูู ุชุฑูุฏ ุญุฐู ุงูููุฑุฏ "${item.name}"ุ`, async () => {
        const result = await window.dataSdk.delete(item);
        if (result.isOk) {
            showMessage('ุชู ุงูุญุฐู ุจูุฌุงุญ', 'success');
        } else {
            showMessage('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู', 'error');
        }
    });
}

async function confirmDeleteProduct(id) {
    const item = allData.find(d => d.__backendId === id);
    if (!item) return;
    
    showConfirmation('ุชุฃููุฏ ุงูุญุฐู', `ูู ุชุฑูุฏ ุญุฐู ุงูููุชุฌ "${item.name}"ุ`, async () => {
        const result = await window.dataSdk.delete(item);
        if (result.isOk) {
            showMessage('ุชู ุงูุญุฐู ุจูุฌุงุญ', 'success');
        } else {
            showMessage('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู', 'error');
        }
    });
}

async function confirmDeleteExpense(id) {
    showConfirmation('ุชุฃููุฏ ุงูุญุฐู', 'ูู ุชุฑูุฏ ุญุฐู ูุฐุง ุงููุตุฑููุ', async () => {
        const item = allData.find(d => d.__backendId === id);
        if (item) {
            const result = await window.dataSdk.delete(item);
            if (result.isOk) {
                showMessage('ุชู ุงูุญุฐู ุจูุฌุงุญ', 'success');
            } else {
                showMessage('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู', 'error');
            }
        }
    });
}

async function confirmDeletePayment(id) {
    showConfirmation('ุชุฃููุฏ ุงูุญุฐู', 'ูู ุชุฑูุฏ ุญุฐู ูุฐุง ุงูุณุฏุงุฏุ', async () => {
        const item = allData.find(d => d.__backendId === id);
        if (item) {
            const result = await window.dataSdk.delete(item);
            if (result.isOk) {
                showMessage('ุชู ุงูุญุฐู ุจูุฌุงุญ', 'success');
            } else {
                showMessage('ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญุฐู', 'error');
            }
        }
    });
}

async function confirmDeletePurchase(invoiceNumber) {
    showConfirmation('ุชุฃููุฏ ุงูุญุฐู', 'ูู ุชุฑูุฏ ุญุฐู ูุงุชูุฑุฉ ุงูุดุฑุงุกุ', async () => {
        const purchases = allData.filter(p => p.type === 'purchase' && p.invoiceNumber === invoiceNumber);
        for (const purchase of purchases) {
            await window.dataSdk.delete(purchase);
        }
        showMessage('ุชู ุงูุญุฐู ุจูุฌุงุญ', 'success');
    });
}

async function confirmReturnSale(invoiceNumber) {
    showConfirmation('ุชุฃููุฏ ุงูุฅุฑุฌุงุน', 'ูู ุชุฑูุฏ ุฅุฑุฌุงุน ูุฐู ุงููุงุชูุฑุฉุ', async () => {
        const sales = allData.filter(s => s.type === 'sale' && s.invoiceNumber === invoiceNumber);
        
        for (const sale of sales) {
            // Return stock
            const product = allData.find(p => p.__backendId === sale.productId);
            if (product) {
                product.currentStock += sale.quantity;
                await window.dataSdk.update(product);
            }
            
            // Update customer
            const customer = allData.find(c => c.__backendId === sale.customerId);
            if (customer) {
                customer.totalPurchases = (customer.totalPurchases || 0) - sale.total;
                if (sale.paymentMethod === 'ุขุฌู') {
                    customer.currentDebt = (customer.currentDebt || 0) - sale.total;
                }
                await window.dataSdk.update(customer);
            }
            
            await window.dataSdk.delete(sale);
        }
        
        showMessage('ุชู ุฅุฑุฌุงุน ุงููุงุชูุฑุฉ ุจูุฌุงุญ', 'success');
    });
}

async function deleteFollowUp(id) {
    const item = allData.find(d => d.__backendId === id);
    if (item) {
        const result = await window.dataSdk.delete(item);
        if (result.isOk) {
            showMessage('ุชู ุงูุญุฐู ุจูุฌุงุญ', 'success');
        }
    }
}

async function deleteListItem(id) {
    const item = allData.find(d => d.__backendId === id);
    if (item) {
        const result = await window.dataSdk.delete(item);
        if (result.isOk) {
            showMessage('ุชู ุงูุญุฐู ุจูุฌุงุญ', 'success');
        }
    }
}

// Initialize default data
async function initializeDefaults() {
    // Add default customer types if none exist
    const customerTypes = allData.filter(d => d.type === 'customer_type');
    if (customerTypes.length === 0) {
        const defaults = ['ุชุฌุฒุฆุฉ', 'ุชุงุฌุฑ', 'ููุฒุน'];
        for (const value of defaults) {
            await window.dataSdk.create({ type: 'customer_type', value: value });
        }
    }
    
    // Add default crops if none exist
    const crops = allData.filter(d => d.type === 'crop');
    if (crops.length === 0) {
        const defaults = ['ููุญ', 'ุฐุฑุฉ', 'ุฃุฑุฒ', 'ูุทู', 'ุจุทุงุทุณ', 'ุทูุงุทู'];
        for (const value of defaults) {
            await window.dataSdk.create({ type: 'crop', value: value });
        }
    }
    
    // Add default units if none exist
    const units = allData.filter(d => d.type === 'unit');
    if (units.length === 0) {
        const defaults = ['ูุทุนุฉ', 'ูููู', 'ูุชุฑ', 'ุทู', 'ูุฑุชููุฉ'];
        for (const value of defaults) {
            await window.dataSdk.create({ type: 'unit', value: value });
        }
    }
    
    // Add default expense categories if none exist
    const expenseCategories = allData.filter(d => d.type === 'expense_category');
    if (expenseCategories.length === 0) {
        const defaults = ['ุฅูุฌุงุฑ', 'ููุฑุจุงุก', 'ููุงู', 'ุฑูุงุชุจ', 'ุตูุงูุฉ', 'ููู', 'ุฃุฎุฑู'];
        for (const value of defaults) {
            await window.dataSdk.create({ type: 'expense_category', value: value });
        }
    }
}

// Call initialization after SDK loads
setTimeout(() => {
    if (allData.length === 0) {
        initializeDefaults();
    }
}, 1000);

    </script>
</body>
</html>